<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="/css/import.css"/>
<link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css" />
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 9999; /* z-indexë¥¼ ë” ë†’ì„ */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }

    /* ê³µí†µ Modal ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
    .modal-content {
        background: white;
        border-radius: 8px;
        margin: 10% auto;
        padding: 20px;
        width: 600px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        position: relative;
        top: 15%;
    }
    .btn-popup-close img {
        float: right;
    }

    #modalGrid {
        height: auto;        /* ë†’ì´ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì • */
        max-height: 500px;   /* í•„ìš”ì— ë”°ë¼ ìµœëŒ€ ë†’ì´ë¥¼ ì§€ì • */
        overflow-y: auto;    /* ìŠ¤í¬ë¡¤ í™œì„±í™” */
    }

    /* ì²´í¬ë°•ìŠ¤ë¥¼ ìˆ˜ì§ ë° ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
    .wj-cell.wj-header .wj-cell-element,
    .wj-cell.wj-header input[type="checkbox"],
    .wj-cell input[type="checkbox"] {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* ì²´í¬ë°•ìŠ¤ ì¹¸ í¬ê¸° ì¡°ì • */
    .wj-header .wj-cell {
        text-align: center !important;
    }


</style>
<th:block layout:fragment="content">

    <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
    <div class="layout-contents">
        <!-- Page Title -->
        <div class="page-title-wrap">
            <div class="left">
                <h2>ì£¼ë¬¸ í˜„í™©</h2><a id="toggleButton" onclick="toggleSearchWrap()"><img src="/images/icon/ico-down.png" alt="ì•ŒëŒ ì•„ì´ì½˜"></a>
                <!--                <a href="#" title="ë¶ë§ˆí¬" class="bookmark toggle">-->
                <!--                    ë‚´ë©”ë‰´-->
                <!--                </a>-->
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="í™ˆì•„ì´ì½˜"></li>
                <li>ì£¼ë¬¸ í˜„í™©</li>
            </ul>
        </div>
        <!-- Select -->
        <div class="search-wrap" id="searchWrap" style="display: none; padding-top:10px">
            <ul>
                <li>
                    <select title="ì‚¬ì—…ì¥ì½”ë“œ" id="search_spjangcd" name="search_sjangcd"
                            onchange="init()">
                        <option value="" hidden selected disabled>ì„ íƒ</option>
                        <option value="ZZ">ì„±ìš°ì—ìŠ¤í”¼(ì£¼)</option>
                        <option value="PP">ì„±ìš°í”¼ì•¤ë¹„(ì£¼)</option>
                        <!-- ì§€ì—­ ì˜µì…˜ì„ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
                    </select>
                </li>
            </ul>
        </div>
        <div class="tab-wrap">
            <ul class="tab-links">
                <li>
                    <a href="#tab1" title="ì£¼ë¬¸ ìº˜ë¦°ë”" class="tab-button">ì£¼ë¬¸ í˜„í™©</a>
                </li>
                <li>
                    <a href="#tab2" title="ì£¼ë¬¸ í™•ì¸" class="tab-button">ì£¼ë¬¸ í™•ì¸</a>
                </li>
            </ul>
            <div class="tab-contents">
                <!-- Section -->
                <section class="tab-item" id="tab1" style="height: 880px; margin-bottom: 10px">
                    <div class="row" style="display: flex;">
                        <!-- ì™¼ìª½ ì„¹ì…˜: 50% ì°¨ì§€ -->
                        <section
                                style="width: 60%; box-sizing: border-box; height: 800px; margin-right: 20px; border-radius: 10px; ">
                            <div class="title-wrap">
                                <h3>ì£¼ë¬¸ í˜„í™©
                                    <img src="/images/icon/exclamation/exclamation-circle.svg"
                                         class="zoom-img" style="margin-left: 5px"
                                         onclick="openPopup('https://foms.atlassian.net/wiki/external/MzgxNTY3NzRmNGM0NGQwZjg5ZjlkYWEzNTRmMmY5MTY')" alt="ë„ì›€ë§">
                                </h3>
                                <div class="btn-wrap">
                                </div>
                            </div>
                            <div class="calendar-wrap">
                                <div id="calendar"></div>
                            </div>
                        </section>
                        <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜ì„ ê°ì‹¸ëŠ” div -->
                        <div style="display: flex; flex-direction: column; width: 40%;">
                            <!-- ìœ„ìª½ ì„¹ì…˜ -->
                            <section style=" box-sizing: border-box;">
                                <div style="margin-bottom: 15px">
                                    <h3 id="year-status">2024ë…„ ì£¼ë¬¸ í˜„í™©</h3>
                                </div>
                                <div class="tab-contents">
                                    <div class="row">
                                        <div class="section-card-wrap" style="gap: 5px">
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer;" class="fetchCard" data-search-type="0">
                                                <div class="title">
                                                    <h3>ì£¼ë¬¸ë“±ë¡</h3>
                                                </div>
                                                <div class="requestCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer;" class="fetchCard" data-search-type="1">
                                                <div class="title">
                                                    <h3>ì£¼ë¬¸í™•ì¸</h3>
                                                </div>
                                                <div class="checkCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer;" class="fetchCard" data-search-type="2">
                                                <div class="title">
                                                    <h3>ì£¼ë¬¸í™•ì •</h3>
                                                </div>
                                                <div class="estimateCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer;" class="fetchCard" data-search-type="3">
                                                <div class="title">
                                                    <h3>ì œì‘ì§„í–‰</h3>
                                                </div>
                                                <div class="produceCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer;" class="fetchCard" data-search-type="4">
                                                <div class="title">
                                                    <h3>ì¶œê³ </h3>
                                                </div>
                                                <div class="deliveryCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                                </div>
                                            </section>
                                        </div> <!--//main-card-wrap end -->
                                    </div>
                                </div>
                            </section>

                            <!-- ì•„ë˜ìª½ ì„¹ì…˜ (ë„“ê²Œ ì„¤ì •) -->
                            <section style="flex: 1; box-sizing: border-box; margin-top: 20px;">
                                <div class="tab-item-sub" id="tab1_2">
                                    <div class="section-top" style="margin-top: 10px;">
                                        <div class="search-wrap">
                                            <dl>
                                                <dt>
                                                    ì¡°íšŒì¼ì<span class="eq">*</span>
                                                </dt>
                                                <dd>
                                                    <ul class="date-box">
                                                        <li>
                                                            <input type="date" id="startDate2" name="startDate">
                                                            <label for="startDate" class="hide">ì‹œì‘ì¼</label>
                                                        </li>
                                                        <li>
                                                            <input type="date" id="endDate2" name="endDate">
                                                            <label for="endDate" class="hide">ì¢…ë£Œì¼</label>
                                                        </li>
                                                        <li>
                                                            <a class="btn btn-delete" title="ê²€ìƒ‰" id="btn-srch" onclick="fetchListData();initDatas();">
                                                                <img src="/images/icon/btn-srch.svg" alt="ê²€ìƒ‰ ì•„ì´ì½˜">
                                                                ê²€ìƒ‰
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </dd>
                                            </dl>
                                        </div>
                                    </div> <!--//section-top end -->
                                    <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
                                        <!-- ê·¸ë¦¬ë“œ ì˜ì—­ -->
                                        <div class="col-12" style="margin-bottom: 10px;">
                                            <div id="theGrid" style="width: 100%; height: 400px;"></div>
                                        </div>
                                    </div>

                                </div>
                            </section>
                        </div>
                    </div>
                </section>
                <section class="tab-item" id="tab2" style="height: 750px; overflow: hidden;">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    ì£¼ë¬¸ì¼ì<span class="eq">*</span>
                                    <img src="/images/icon/exclamation/exclamation-circle.svg"
                                         class="zoom-img" style="margin-left: 5px"
                                         onclick="openPopup('https://foms.atlassian.net/wiki/external/YmJjMmQ2OTE2ZGRkNDMzMjg1ZDMzNDg4OWU2NDZlN2Q')" alt="ë„ì›€ë§">
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <input type="date" id="startDate" name="startDate">
                                            <label for="startDate" class="hide">ì‹œì‘ì¼</label>
                                        </li>
                                        <li>
                                            <input type="date" id="endDate" name="endDate">
                                            <label for="endDate" class="hide">ì¢…ë£Œì¼</label>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="searchCltnm">
                                        ì—…ì²´ëª…<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
                                        <input type="text" id="searchCltnm" name="searchCltnm" class="input-srch"
                                               placeholder="ì—…ì²´ëª…" style="border-radius: 5px;">
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="searchtketnm">
                                        ì œëª©<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
                                        <input type="text" id="searchtketnm" name="searchtketnm" class="input-srch"
                                               placeholder="ì œëª©" style="border-radius: 5px;">
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="searchstate">
                                        ì§„í–‰êµ¬ë¶„<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
                                        <select id="searchstate" name="searchstate">
                                            <option value="all"></option>
                                        </select>
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="ê²€ìƒ‰" id="searchButton1" onclick="fetchListData2()">
                                            <!--                                        class ì“°ì´ëŠ” ê³³ ì°¾ê³  ì—†ìœ¼ë©´ í´ë˜ìŠ¤ëª… ìˆ˜ì •í•˜ê¸°-->
                                            <img src="/images/icon/btn-srch.svg" alt="ê²€ìƒ‰ ì•„ì´ì½˜">
                                            ê²€ìƒ‰
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="ì£¼ë¬¸ í™•ì¸" id="CheckOK" onclick="CheckOK()">
                                            <img src="/images/icon/bag-check.svg" alt="ì£¼ë¬¸ í™•ì¸ìˆ˜ì • ì•„ì´ì½˜">
                                            ì£¼ë¬¸ í™•ì¸
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="ì£¼ë¬¸ í™•ì¸ ì·¨ì†Œ" id="Check" onclick="CheckOK()">
                                            <img src="/images/icon/bag-dash.svg" alt="ì£¼ë¬¸ í™•ì¸ ì·¨ì†Œ ì•„ì´ì½˜">
                                            ì£¼ë¬¸ í™•ì¸ ì·¨ì†Œ
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                        </div>
                    </div>
                    <div class="container-fluid">
                        <p id="selectedItem"></p>
                        <div id="theGrid2" style="max-height: 630px"></div>
                    </div>
                </section>
            </div>
        </div>
        </section>
    </div> <!--//tab-contens end-->
    </div> <!--//tab-wrap end-->
    </div> <!--//layout-contents end -->
    <footer style="margin-top:5px;">
        <p>Copyrightâ“’ 0000 corp. All rights reserved.</p>
    </footer>
    <div style="height: 10px"></div>

    <!--ì—…ì²´ ëª¨ë‹¬-->
    <div class="modal">
        <div id="CltnmModal" style="display: none;">
            <div class="modal-content">
                <h2 style="text-align: center;">ê±°ë˜ì²˜ ì •ë³´ ìƒì„¸</h2>
                <a title="íŒì—…ë‹«ê¸°" onclick="closePopup('CltnmModal')" class="btn-popup-close">
                    <img src="/images/icon/btn-popup-close.svg" style=" float: right; right: 30px;" alt="ë‹«ê¸°">
                </a>
                <form id="CltnmFindForm">
                    <div id="modalGrid" style="height: 350px;width: 100%; margin-right:0px;  margin-top: 20px;"></div>
                </form>
            </div>
        </div>
    </div>

    <!--í˜ì´ì§€ ì„¤ëª… ëª¨ë‹¬ -->
    <div class="modal">
        <div id="PageModal" style="display: none;">
            <div class="modal-content">
                <h2 style="text-align: center;">ì£¼ë¬¸ í˜„í™© í˜ì´ì§€ ì„¤ëª…</h2>
                <a title="íŒì—…ë‹«ê¸°" onclick="closePopup('PageModal')" class="btn-popup-close">
                    <img src="/images/icon/btn-popup-close.svg" style="float: right; right: 30px;" alt="ë‹«ê¸°">
                </a>
                <form id="PageFindForm">
                    <p style="text-align: center;">
                        <a href="https://foms.atlassian.net/l/cp/X9iSn8Tt"
                           target="_blank"
                           style="color: blue; text-decoration: underline;">
                            Atlassian Wikiì—ì„œ í˜ì´ì§€ ë³´ê¸°
                        </a>
                    </p>
                </form>
            </div>
        </div>
    </div>
       <!-- ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­ ëª¨ë‹¬ -->
    <div class="modal">
        <div class="popup-wrapper w700" id="OrdtextModal" style="display: none; min-width: 1050px;">
            <div class="popup-title">
                <h3>ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­</h3>
                <a title="íŒì—…ë‹«ê¸°" onclick="closePopup('OrdtextModal')" class="btn-popup-close">
                    <img src="/images/icon/btn-popup-close.svg" alt="ë‹«ê¸°" style="float: right; right: 30px;">
                </a>
            </div>
            <div class="popup-contents">
                <div class="table-wrap">
                    <table class="write-table" style="border-top: 0px;">
                        <caption>ì£¼ë¬¸ì˜ë¢° ìš”ì²­ì‚¬í•­</caption>
                        <colgroup>
                            <col class="wp20">
                            <col class="wp80">
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>
                                <div class="table-wrap">
                                    <table class="write-table">
                                        <caption>ìš”ì²­ì‚¬í•­</caption>
                                        <tbody>
                                        <tr style="align-items: center">
                                            <th>
                                                <label for="ordtext">ë‚´ìš©</label>
                                            </th>
                                            <td colspan="3">
                                                <div class="textarea-box">
                                                    <textarea id="ordtext"></textarea>
                                                </div>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


</th:block>
<th:block layout:fragment="scripts">
    <th:block th:replace="/common/columns_setting :: columns_setting"></th:block>
    <script>
        tinymce.init({
            language: "ko_KR",
            selector: "#ordtext",
            plugins: "paste image imagetools",
            height: 500,
            width: 900,
            toolbar: false,       // íˆ´ë°” ë¹„í™œì„±í™”
            menubar: false,       // ìƒë‹¨ ë©”ë‰´ ë¹„í™œì„±í™”
            readonly: 1,          // ì½ê¸° ì „ìš© ëª¨ë“œ í™œì„±í™”
            paste_data_images: true,
            file_picker_types: 'image',
            automatic_uploads: false // ìë™ ì—…ë¡œë“œ ë¹„í™œì„±í™”
        });

    </script>
    <script type="text/javascript">

        let theGrid;
        let theGrid2;
        let calendar;
        let modalGrid;
        let viewdata2;
        let viewdata;

        // ì£¼ë¬¸í˜„í™© ë…„ë„ ìë™í™”
        const currentYear = new Date().getFullYear();
        document.getElementById('year-status').innerText = `${currentYear}ë…„ ì£¼ë¬¸ í˜„í™©`;

        document.readyState === 'complete' ? init() : window.onload = init;
        let isBindSpjangcdCalled = false;


        // ì´ˆë°˜ í˜ì´ì§€ ì§„ì…ì‹œ ê·¸ë¦¬ë“œ ë°”ì¸ë”© ì‹œì‘
        function init() {
            if (!isBindSpjangcdCalled) {
                bindSpjangcd();
                isBindSpjangcdCalled = true; // í”Œë˜ê·¸ ì—…ë°ì´íŠ¸
            }
            fetchListData();
            initCalendar();
            fetchListData2();
            initDatas();
        }

        $(document).ready(function() {
            // í˜„ì¬ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth(); // 0ë¶€í„° ì‹œì‘í•˜ëŠ” ì›”(0 = 1ì›”)

            // ì‹œì‘ì¼: ë‹¹ì›” 1ì¼
            const startOfMonth = new Date(year, month, 1);
            const startMonthFormatted = startOfMonth.getFullYear() + '-' + String(startOfMonth.getMonth() + 1).padStart(2, '0') + '-' + String(startOfMonth.getDate()).padStart(2, '0');
            $('#startDate').val(startMonthFormatted);
            $('#startDate2').val(startMonthFormatted);

            // ì¢…ë£Œì¼: í˜„ì¬ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ 
            const endOfMonth = new Date(year, month + 1, 0); // ë‹¤ìŒ ë‹¬ 0ì¼ì€ í˜„ì¬ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ 
            const endMonthFormatted = endOfMonth.getFullYear() + '-' + String(endOfMonth.getMonth() + 1).padStart(2, '0') + '-' + String(endOfMonth.getDate()).padStart(2, '0');
            $('#endDate').val(endMonthFormatted);
            $('#endDate2').val(endMonthFormatted);
        });

        // '.fetchCard' í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ëª¨ë“  ìš”ì†Œì— ëŒ€í•´ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
        $('.fetchCard').click(function() {
            // í´ë¦­ëœ ì¹´ë“œì˜ data-search-type ì†ì„± ê°’ ê°€ì ¸ì˜¤ê¸°
            const searchTypeValue = $(this).data('search-type');
            fetchListData(searchTypeValue);  // í•´ë‹¹ ê°’ì„ fetchListData í•¨ìˆ˜ë¡œ ì „ë‹¬
        });
        function fetchListData(searchTypeValue) {
            let data2 = []; // ë°ì´í„°ë¥¼ ë‹´ì„ ë°°ì—´
            let emptyRowsCount = 8;
            $.ajax({
                url: '/api/order_status/readCalenderGrid',
                type: 'GET',
                data: {
                    'search_spjangcd': $('#search_spjangcd').val(),
                    'search_startDate': $('#startDate2').val(),
                    'search_endDate': $('#endDate2').val(),
                    'search_type': searchTypeValue
                },
                async: false,
                success: function (response) {
                    // ì‘ë‹µì´ ì˜¬ë°”ë¥´ê²Œ ë„ì°©í–ˆê³ , data ì†ì„±ì´ ë°°ì—´ì¸ì§€ í™•ì¸
                    if (response && Array.isArray(response.data)) {
                        data2 = response.data;
                        // ë‚ ì§œ í˜•ì‹ ë³€í™˜ ë° ordflag ë³€í™˜
                        data2.forEach(item => {

                        });
                    }
                },
                error: function () {
                    console.error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });

            // ë¹ˆ ê°ì²´ë¥¼ emptyRowsCountë§Œí¼ ì¶”ê°€
            if(data2.length < emptyRowsCount) {
                for (let i = 0; emptyRowsCount - data2.length ; i++) {
                    data2.push({
                        ordflag: '',
                        reqdate: '',
                        remark: '',
                        deldate: '',
                        amount: ''
                    });
                }
            }
            viewdata2 = new wijmo.collections.CollectionView(data2);
            if (!theGrid) {
                theGrid = new wijmo.grid.FlexGrid('#theGrid', {
                    autoGenerateColumns: false,
                    showMarquee: true,
                    columns: [
                        { binding: 'ordflag', header: 'ì§„í–‰êµ¬ë¶„', align: 'center', width: 100 },
                        { binding: 'reqdate', header: 'ì˜ë¢°ì¼ì', align: 'center', width: 120 },
                        { binding: 'cltnm', header: 'ì—…ì²´ëª…', align: 'left', width: 150 },
                        { binding: 'remark', header: 'ì œëª©', align: 'left', width: 160 },
                        { binding: 'deldate', header: 'ë‚©í’ˆí¬ë§ì¼', align: 'center', width: 120 },
                        { binding: 'amount', header: 'ê¸ˆì•¡', align: 'center', width: 200 }
                    ],
                    itemsSource: viewdata2 // ë¹ˆ ê°ì²´ê°€ ì¶”ê°€ëœ ë°°ì—´ ì‚¬ìš©
                });
                // í—¤ë”ë¥¼ ì¤‘ì•™ ì •ë ¬í•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
                theGrid.formatItem.addHandler(function (s, e) {
                    if (e.panel === s.columnHeaders) {
                        e.cell.style.textAlign = 'center';
                    }
                });

                // ì„ íƒì´ ë³€ê²½ë  ë•Œ, í˜„ì¬ í•­ëª© ì—…ë°ì´íŠ¸
                theGrid.rowHeaders.columns.splice(0, 1);
                new FlexGridContextMenu(theGrid);
                window.downloadFileName = 'ì£¼ë¬¸ í˜„í™©(ìº˜ë¦°ë”)';
            } else {
                // ì´ë¯¸ FlexGridì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°, ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸
                theGrid.itemsSource = viewdata2; // ë¹ˆ ê°ì²´ê°€ ì¶”ê°€ëœ ë°°ì—´ ì‚¬ìš©
            }
        }
        /* ìº˜ë¦°ë” ==========================================================================================================================*/

        function initCalendar() {
           var calendarEl = document.getElementById('calendar');
           if (calendarEl) {
               // FullCalendar ì„¤ì •
               calendar = new FullCalendar.Calendar(calendarEl, {
                   locale: 'ko',
                   headerToolbar: {
                       left: 'prev,next today',
                       center: 'title',
                       right: 'dayGridMonth' ,
                   },
                   initialView: 'dayGridMonth',
                   height: 714,
                   dayHeaderFormat: { weekday: 'short' },
                   views: {
                       dayGridMonth: {
                           dayCellContent: function (arg) {
                               return arg.dayNumberText.replace('ì¼', '');
                           }
                       }
                   },
                   dateClick: function (info) {
                       console.log('Clicked on: ' + info.dateStr);
                   },
                   events: [] // ê¸°ë³¸ ì´ë²¤íŠ¸ëŠ” ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •
               });

               // ê³µíœ´ì¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
               fetchHolidays().then(holidays => {
                   holidays.forEach(holiday => {
                       calendar.addEvent({
                           title: holiday.name, // ê³µíœ´ì¼ ì´ë¦„
                           start: holiday.date,  // ê³µíœ´ì¼ ë‚ ì§œ
                           backgroundColor: '#EC193A',
                           borderColor: '#EC193A',
                           textColor: 'white'
                       });
                   });
                   setTimeout(() => {
                       calendar.render(); // ìº˜ë¦°ë” ë Œë”ë§
                       console.log('ìº˜ë¦°ë”ê°€ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤.');
                   }, 500); // 500ms ë”œë ˆì´
               }).catch(error => {
                   console.error('ê³µíœ´ì¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
               });
               // ì£¼ë¬¸í˜„í™© ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
               fetchOrderDates().then(orderDates =>{
                   console.log("holidays : ", orderDates)
                   orderDates.forEach(orderDate => {
                       switch (orderDate.name) {
                           case 'ì£¼ë¬¸ë“±ë¡':
                               calendar.addEvent({
                                   title: 'ì£¼ë¬¸ë“±ë¡', // ì§„í–‰êµ¬ë¶„ ì´ë¦„
                                   start: orderDate.date,  // ì§„í–‰ì˜ë¢° ë‚ ì§œ
                                   backgroundColor: '#031B4B',
                                   borderColor: '#031B4B',
                                   textColor: 'white'
                               });
                               break;
                           case 'ì£¼ë¬¸í™•ì¸':
                               calendar.addEvent({
                                   title: 'ì£¼ë¬¸í™•ì¸', // ì§„í–‰êµ¬ë¶„ ì´ë¦„
                                   start: orderDate.date,  // ì§„í–‰ì˜ë¢° ë‚ ì§œ
                                   backgroundColor: '#03428E',
                                   borderColor: '#03428E',
                                   textColor: 'white'
                               });
                               break;
                           case 'ì£¼ë¬¸í™•ì •':
                               calendar.addEvent({
                                   title: 'ì£¼ë¬¸í™•ì •', // ì§„í–‰êµ¬ë¶„ ì´ë¦„
                                   start: orderDate.date,  // ì§„í–‰ì˜ë¢° ë‚ ì§œ
                                   backgroundColor: '#3069B3',
                                   borderColor: '#3069B3',
                                   textColor: 'white'
                               });
                               break;
                           case 'ì œì‘ì§„í–‰':
                               calendar.addEvent({
                                   title: 'ì œì‘ì§„í–‰', // ì§„í–‰êµ¬ë¶„ ì´ë¦„
                                   start: orderDate.date,  // ì§„í–‰ì˜ë¢° ë‚ ì§œ
                                   backgroundColor: '#C7DFF4',
                                   borderColor: 'rgba(2,165,255,0.07)',
                                   textColor: 'black'
                               });
                               break;
                           case 'ì¶œê³ ':
                               calendar.addEvent({
                                   title: 'ì¶œê³ ', // ì§„í–‰êµ¬ë¶„ ì´ë¦„
                                   start: orderDate.date,  // ì§„í–‰ì˜ë¢° ë‚ ì§œ
                                   backgroundColor: 'white',
                                   borderColor: 'grey',
                                   textColor: 'black'
                               });
                               break;
                           default:
                               console.log("ì£¼ë¬¸í˜„í™© ë°”ì¸ë“œ ì˜¤ë¥˜ : ", orderDate.name);
                       }
                   });
                   setTimeout(() => {
                       calendar.render(); // ìº˜ë¦°ë” ë Œë”ë§
                       console.log('ìº˜ë¦°ë”ê°€ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤.');
                   }, 500);
               }).catch(error => {
                   console.error('ì£¼ë¬¸í˜„í™© ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
               });
           }
       }
       // ê³µíœ´ì¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
       async function fetchHolidays() {
           const currentYear = new Date().getFullYear();
           const yearsToFetch = [currentYear - 1, currentYear, currentYear + 1]; // ì „ë…„ë„, í˜„ì¬ ì—°ë„, ë‹¤ìŒ ì—°ë„ ë°°ì—´ ìƒì„±

           const holidays = [];

           for (const year of yearsToFetch) {
               const yearHolidays = await fetchHolidaysForYear(year);
               holidays.push(...yearHolidays);
           }

           return holidays;
       }
        // ì£¼ë¬¸í˜„í™© ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        async function fetchOrderDates() {
            let data2 = []; // ë°ì´í„°ë¥¼ ë‹´ì„ ë°°ì—´
            let emptyRowsCount = 8;
            var orderDates = [];
            $.ajax({
                url: '/api/order_status/readCalenderGrid2',
                type: 'GET',
                data: {
                    'search_spjangcd': $('#search_spjangcd').val()
                },
                async: false,
                success: function (response) {
                    // ì‘ë‹µì´ ì˜¬ë°”ë¥´ê²Œ ë„ì°©í–ˆê³ , data ì†ì„±ì´ ë°°ì—´ì¸ì§€ í™•ì¸
                    if (response && Array.isArray(response.data)) {
                        data2 = response.data;
                        // ë‚ ì§œ í˜•ì‹ ë³€í™˜ ë° ordflag ë³€í™˜
                        console.log("ìº˜ë¦°ë” ë°ì´í„° : ", data2);
                    }
                },
                error: function () {
                    console.error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });

            // viewdata.itemsë¥¼ ë°˜ë³µí•˜ì—¬ ê° í•­ëª©ì˜ ordflagì™€ reqdate ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            for (var i = 0; i < data2.length; i++) {
                var item = data2[i];
                orderDates.push({
                    name: item.ordflag,
                    date: item.reqdate
                });
            }
            console.log("orderDates : ", orderDates)
            return orderDates;
        }

        //api ìš”ì²­
        async function fetchHolidaysForYear(year) {
            return new Promise((resolve, reject) => {
                var xhr = new XMLHttpRequest();
                var url = 'http://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService/getRestDeInfo';
                var queryParams = '?' + encodeURIComponent('serviceKey') + '=' + 'R3P3syhq6qRP0cz8mbV2J5t%2B32WwaSN9sH8ZW4k59oKAU3Ze0WvcljMrN36OJqxs38%2F780hMD4QfhCiDZQNUyA%3D%3D';
                queryParams += '&' + encodeURIComponent('solYear') + '=' + encodeURIComponent(year);
                queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30');

                xhr.open('GET', url + queryParams);
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        if (this.status == 200) {
                            var parser = new DOMParser();
                            var xmlDoc = parser.parseFromString(this.responseText, "text/xml");

                            // XMLì—ì„œ ì›í•˜ëŠ” ë°ì´í„° ì¶”ì¶œ
                            var items = xmlDoc.getElementsByTagName("item");
                            let holidays = [];
                            for (var i = 0; i < items.length; i++) {
                                var locdate = items[i].getElementsByTagName("locdate")[0].textContent;
                                var dateName = items[i].getElementsByTagName("dateName")[0].textContent;

                                holidays.push({ date: locdate, name: dateName });
                            }
                            resolve(holidays);
                        } else {
                            console.error('ì˜¤ë¥˜ ë°œìƒ. HTTP ìƒíƒœ ì½”ë“œ:', this.status);
                            reject(this.status);
                        }
                    }
                };

                xhr.send();
            });
        }

        /*==============ìº˜ë¦°ë” ë=============================================================================================================*/

        function fetchListData2() {
            let data2 = []; // ë°ì´í„°ë¥¼ ë‹´ì„ ê¸°ë³¸ ë°°ì—´ ì´ˆê¸°í™”

            // ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            $.ajax({
                url: '/api/order_status/read',
                type: 'GET',
                data: {
                    'search_spjangcd': $('#search_spjangcd').val(),
                    'startDate': $('#startDate').val(),
                    'endDate':$('#endDate').val(),
                    'searchCltnm' :$('#searchCltnm').val(),
                    'searchtketnm' :$('#searchtketnm').val(),
                    'searchstate' :$('#searchstate').val()

                },
                async: false,
                success: function (response) {
                    if (response && Array.isArray(response.data)) {
                        data2 = response.data;

                        // ë°ì´í„° ì „ì²˜ë¦¬
                        data2.forEach(item => {
                            item.reqdate = formatDateString(item.reqdate);
                            item.deldate = formatDateString(item.deldate);
                            item.ordflag = getOrdflagText(parseInt(item.ordflag, 10));
                            item.hgrb = getHgrb((item.hgrb));
                            item.exfmtypedv = getListCgrb(item.exfmtypedv);
                            item.infmtypedv = getListCgrb(item.infmtypedv);
                            item.stframedv = getListCgrb(item.stframedv);
                            item.stexplydv = getListCgrb(item.stexplydv);
                            if (item.ordtext) {
                                item.originalOrdtext = item.ordtext;
                                item.ordtext = "ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­";
                            }
                            item.isdownload = item.isdownload === true;
                        });
                        console.log("ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°(ì£¼ë¬¸í˜„í™©):", data2);
                        //data2 = removeDuplicates(data2, ['ordflag', 'reqdate', 'deldate']);
                    }
                },
                error: function () {
                    console.error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });

            // ìˆœë²ˆ ì¶”ê°€ ë° ë¹ˆ í–‰ ì¶”ê°€
            const minimumRows = 15;
            data2.forEach((item, index) => {
                item.rownum = index + 1;
            });

            if (data2.length < minimumRows) {
                const additionalRows = minimumRows - data2.length;
                for (let i = 0; i < additionalRows; i++) {
                    data2.push({
                        rownum: data2.length + 1,
                        ordflag: '',
                        reqdate: '',
                        cltnm: '',
                        remark: '',
                        deldate: '',
                        hgrb: '',
                        qty: '',
                        panel_t: '',
                        panel_w: '',
                        panel_l: '',
                        exfmtypedv: '',
                        infmtypedv: '',
                        stframedv: '',
                        stexplydv: '',
                        downloads: '',
                        ordtext: '',
                        reqnum:'',
                        isdownload: ''
                    });
                }
            }

            // CollectionView ìƒì„±
            let viewdata = new wijmo.collections.CollectionView(data2);

            // ê·¸ë£¹í™” ì„¤ì •
            let reqdateGroup = new wijmo.collections.PropertyGroupDescription('reqdate', (item, prop) => {
                return item[prop];
            });

            let cltnmReqnumGroup = new wijmo.collections.PropertyGroupDescription(
                '',  // âœ… ì»¤ìŠ¤í…€ ê·¸ë£¹ í‚¤ ì‚¬ìš©
                (item) => `${item.cltnm}_${item.reqnum}`, // âœ… ë‚´ë¶€ì ìœ¼ë¡œëŠ” cltnm + reqnumìœ¼ë¡œ ê·¸ë£¹í™”
                (item, prop) => item.cltnm // âœ… UIì—ëŠ” cltnmë§Œ ë³´ì´ê²Œ ì„¤ì •
            );

            viewdata.groupDescriptions.clear();
            viewdata.groupDescriptions.push(reqdateGroup);
            viewdata.groupDescriptions.push(cltnmReqnumGroup);

            viewdata.groupHeaderFormat = '{name}';

            // ê·¸ë£¹ë³„ í–‰ ë²ˆí˜¸ ë‹¤ì‹œ ì„¤ì •
            const resetRowNumbers = () => {
                if (viewdata.groups) {
                    viewdata.groups.forEach(firstGroup => { // 1ì°¨ ê·¸ë£¹ (reqdate)
                        if (firstGroup.groups) { // 2ì°¨ ê·¸ë£¹(cltnm)ì´ ì¡´ì¬í•˜ë©´ ì²˜ë¦¬
                            firstGroup.groups.forEach(secondGroup => { // 2ì°¨ ê·¸ë£¹ (cltnm)
                                let rowNumber = 1; // ê° 2ì°¨ ê·¸ë£¹ë³„ë¡œ í–‰ ë²ˆí˜¸ ì´ˆê¸°í™”
                                secondGroup.items.forEach(item => {
                                    item.rownum = rowNumber++;
                                });
                            });
                        } else { // 2ì°¨ ê·¸ë£¹ì´ ì—†ê³  1ì°¨ ê·¸ë£¹ë§Œ ìˆì„ ê²½ìš° ì²˜ë¦¬
                            let rowNumber = 1;
                            firstGroup.items.forEach(item => {
                                item.rownum = rowNumber++;
                            });
                        }
                    });
                }
            };

            // ê²€ìƒ‰ í›„ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•œ ê²½ìš°ì—ë„ ì´ˆê¸°í™”
            resetRowNumbers();

            // FlexGrid ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
            if (!theGrid2) {
                theGrid2 = new wijmo.grid.FlexGrid('#theGrid2', {
                    autoGenerateColumns: false,
                    showMarquee: true,
                    isReadOnly: true,
                    selectionMode: 'ListBox',
                    virtualizationThreshold: 1,
                    columns: [
                        {binding: 'rownum', header: 'ìˆœë²ˆ', width: 100, align: 'center'},
                        {binding: 'ordflag', header: 'ì§„í–‰êµ¬ë¶„', width: '*', minWidth: 100, align: 'center'},
                        {binding: 'reqdate', header: 'ì£¼ë¬¸ì¼ì', width: '*', minWidth: 150, align: 'center'},
                        {binding: 'cltnm', header: 'ì—…ì²´ëª…', width: '*', minWidth: 150, align: 'left'},
                        {binding: 'remark', header: 'ì œëª©', width: '*', minWidth: 400, align: 'left'},
                        {binding: 'deldate', header: 'ë‚©í’ˆí¬ë§ì¼', width: '*', minWidth: 150, align: 'center'},
                        {binding: 'hgrb', header: 'ì œí’ˆêµ¬ì„±', width: '*', minWidth: 100, align: 'center'},
                        {binding: 'qty', header: 'ìˆ˜ëŸ‰', width: 80, align: 'right'},
                        {binding: 'panel_t', header: 'T(ë‘ê»˜)', width: 80, align: 'right'},
                        {binding: 'panel_w', header: 'W/H(í­ ë˜ëŠ” ë†’ì´)', width: 150, align: 'right'},
                        {binding: 'panel_l', header: 'L(ê¸¸ì´)', width: 80, align: 'right'},
                        {binding: 'exfmtypedv', header: 'ì™¸ë¶€ë§ˆê°ì¬', width: '*', minWidth: 100, align: 'center'},
                        {binding: 'infmtypedv', header: 'ì™¸ë¶€ë³´ê°•ì¬', width: '*', minWidth: 100, align: 'center'},
                        {binding: 'stframedv', header: 'ë‚´ë¶€ë³´ê°•ì¬', width: '*', minWidth: 100, align: 'center'},
                        {binding: 'stexplydv', header: 'ë‚´ë¶€ë§ˆê°ì¬', width: '*', minWidth: 100, align: 'center'},
                        {binding: 'downloads', header: 'ì²¨ë¶€íŒŒì¼', width: '*', minWidth: 105, align: 'center'},
                        {binding: 'ordtext', header: 'ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­', width: '*', minWidth: 200, align: 'left'},
                        {binding: 'reqnum', visible: false},  // ìˆ¨ê¸¸ ì»¬ëŸ¼
                        {binding: 'isdownload', visible: false}
                    ],

                    itemsSource: viewdata,
                    formatItem: function(s, e) {
                        if (e.panel.cellType === wijmo.grid.CellType.Cell) {
                            const col = s.columns[e.col]; // í˜„ì¬ ì»¬ëŸ¼ ì •ë³´
                            const item = s.rows[e.row]?.dataItem; // í˜„ì¬ í–‰ ë°ì´í„°

                            // "ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­" ë§í¬ ì²˜ë¦¬
                            if (col.binding === 'ordtext' && item && item.ordtext === "ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­") {
                                e.cell.innerHTML = `<a href="#" class="ordtext-link" onclick="showPopupById('OrdtextModal', ${e.row})">ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­</a>`;
                            }

                            // ë‹¤ìš´ë¡œë“œ ë§í¬ ì²˜ë¦¬
                            if (col.binding === 'downloads') {
                                //console.log('downloads column detected', item); // ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€
                                e.cell.innerHTML = ''; // ì…€ ë‚´ìš© ì´ˆê¸°í™”
                                if (item.isdownload) { // ë°ì´í„°ì— ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ ìƒíƒœ ì—¬ë¶€ í™•ì¸
                                    //console.log('Download link added for item:', item); // ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€
                                    e.cell.innerHTML = '<a title="ë‹¤ìš´ë¡œë“œ" class="btn-filedown" onclick="downloadFile_order_status()">ë‹¤ìš´ë¡œë“œ</a>';
                                }
                            }
                        }
                    }
                });

                // âœ… theGrid2 ì´ˆê¸°í™” í›„ Selector ë°”ì¸ë”©
                let selector = new wijmo.grid.selector.Selector(theGrid2, {
                    itemChecked: () => {
                        console.log("âœ… ì²´í¬ë°•ìŠ¤ ì„ íƒë¨!");
                        showCheckedCount(selector);
                    }
                });

                new FlexGridContextMenu(theGrid2);
                window.downloadFileName = 'ì§„í–‰ í˜„í™©';

                theGrid2.beginningEdit.addHandler((s, e) => {
                    e.cancel = true;
                });
            } else {
                theGrid2.itemsSource = viewdata;
            }
        }

        function showCheckedCount(selector) {
            let cntElement = document.getElementById('checked-count');

            if (cntElement) {
                let selectedRows = [];

                // âœ… ìµœì‹  wijmo ë²„ì „ ëŒ€ì‘: `getCheckedItems()` ë˜ëŠ” `isSelected` ë°©ì‹ ì‚¬ìš©
                if (typeof selector.getCheckedItems === "function") {
                    selectedRows = selector.getCheckedItems();
                } else {
                    console.warn("â— `selector.getCheckedItems()`ê°€ ë¹ˆ ë°°ì—´ì„ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤. `isSelected` ë°©ì‹ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.");
                    selectedRows = theGrid2.rows.filter(r => r.isSelected).map(row => row.dataItem);
                }

                // âœ… ì²´í¬ëœ í–‰ ë°ì´í„° ì½˜ì†”ì— ì¶œë ¥
                console.log("ğŸ” ìµœì¢… ì„ íƒëœ í–‰ ë°ì´í„°:", selectedRows);

                if (selectedRows.length === 0) {
                    console.warn("â— ì—¬ì „íˆ ì„ íƒëœ í–‰ì´ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                cntElement.textContent = selectedRows.length.toString();

                let selectedGroupInfo = new Set();

                selectedRows.forEach(item => {
                    let groupKey = `${item.cltnm}_${item.reqnum}`;
                    selectedGroupInfo.add(groupKey);
                });

                let groupInfoArray = Array.from(selectedGroupInfo);
                console.log("âœ… ì„ íƒëœ í–‰ì˜ ê·¸ë£¹ ì •ë³´:", groupInfoArray);
            }
        }

        //ë‹¤ìš´ë¡œë“œ
        function downloadFile_order_status() {
            let selectedItems = theGrid2.selectedItems; // ì„ íƒëœ í•­ëª© ê°€ì ¸ì˜¤ê¸°
            let downloadList = [];

            // ì„ íƒëœ í•­ëª©ì—ì„œ ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ ëª©ë¡ ìƒì„±
            selectedItems.forEach(function (item) {
                downloadList.push({
                    reqnum: item.reqnum
                });
            });

            // ë‹¤ìš´ë¡œë“œ URL ì§€ì •
            let downloadUrl = '/api/request/request/downloader';

            // Jung.jsì—ì„œ ì •ì˜í•œ downloadFiles í•¨ìˆ˜ í˜¸ì¶œ
            downloadFiles(downloadList, downloadUrl);
        }

        //ë‚ ì§œ í¬ë§·
        function formatDateString(dateString) {
            if (!dateString || dateString.length !== 8) return dateString; // ìœ íš¨ì„± ê²€ì‚¬
            const year = dateString.substring(0, 4);
            const month = dateString.substring(4, 6);
            const day = dateString.substring(6, 8);
            return `${year}-${month}-${day}`;
        }

        // ordflag ê°’ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function getOrdflagText(ordflag) {
            switch (parseInt(ordflag, 10)) { // ordflagë¥¼ ìˆ«ìë¡œ ë³€í™˜
                case 0:
                    return "ì£¼ë¬¸ë“±ë¡";
                case 1:
                    return "ì£¼ë¬¸í™•ì¸";
                case 2:
                    return "ì£¼ë¬¸í™•ì •";
                case 3:
                    return "ì œì‘ì§„í–‰";
                case 4:
                    return "ì¶œê³ "
                default:
                    return " ";
            }
        }

        function getHgrb(hgrb) {
            switch (hgrb) {
                case 'A0': return "ì§€ë¶•";
                case 'AA': return "ì§€ë¶•1";
                case 'AB': return "ì§€ë¶•2";
                case 'AC': return "ì§€ë¶•3";
                case 'AD': return "ì§€ë¶•4";
                case 'AE': return "ì§€ë¶•5";
                case 'AF': return "ì§€ë¶•6";
                case 'B0': return "ë°”ë‹¥";
                case 'BA': return "ë°”ë‹¥1";
                case 'BB': return "ë°”ë‹¥2";
                case 'BC': return "ë°”ë‹¥3";
                case 'BD': return "ë°”ë‹¥4";
                case 'BE': return "ë°”ë‹¥5";
                case 'BF': return "ë°”ë‹¥6";
                case 'C0': return "ì˜†ì¥";
                case 'C1': return "ì˜†ì¥1";
                case 'C2': return "ì˜†ì¥2";
                case 'C3': return "ì˜†ì¥3";
                case 'C4': return "ì˜†ì¥4";
                case 'C5': return "ì˜†ì¥5";
                case 'C6': return "ì˜†ì¥6";
                case 'CA': return "ìš´ì „ì„";
                case 'CB': return "ìš´ì „ì„1";
                case 'CC': return "ìš´ì „ì„2";
                case 'CD': return "ìš´ì „ì„3";
                case 'CE': return "ìš´ì „ì„4";
                case 'CF': return "ìš´ì „ì„5";
                case 'CG': return "ìš´ì „ì„6";
                case 'CN': return "ì¡°ìˆ˜ì„";
                case 'CO': return "ì¡°ìˆ˜ì„1";
                case 'CP': return "ì¡°ìˆ˜ì„2";
                case 'CQ': return "ì¡°ìˆ˜ì„3";
                case 'CR': return "ì¡°ìˆ˜ì„4";
                case 'CS': return "ì¡°ìˆ˜ì„5";
                case 'CT': return "ì¡°ìˆ˜ì„6";
                case 'D0': return "ì•ì¥";
                case 'DA': return "ì•ì¥1";
                case 'DB': return "ì•ì¥2";
                case 'DC': return "ì•ì¥3";
                case 'DD': return "ì•ì¥4";
                case 'DE': return "ì•ì¥5";
                case 'DF': return "ì•ì¥6";
                case 'E0': return "ë’·ì¥";
                case 'EA': return "ë’·ì¥1";
                case 'EB': return "ë’·ì¥2";
                case 'EC': return "ë’·ì¥3";
                case 'ED': return "ë’·ì¥4";
                case 'EE': return "ë’·ì¥5";
                case 'EF': return "ë’·ì¥6";
                case 'F0': return "ì¹¸ë§‰ì´";
                case 'FA': return "ì¹¸ë§‰ì´1";
                case 'FB': return "ì¹¸ë§‰ì´2";
                case 'FC': return "ì¹¸ë§‰ì´3";
                case 'FD': return "ì¹¸ë§‰ì´4";
                case 'FE': return "ì¹¸ë§‰ì´5";
                case 'FF': return "ì¹¸ë§‰ì´6";
                case 'G0': return "ë„ì–´";
                case 'GA': return "ë„ì–´1";
                case 'GB': return "ë„ì–´2";
                case 'GC': return "ë„ì–´3";
                case 'GD': return "ë„ì–´4";
                case 'GE': return "ë„ì–´5";
                case 'GF': return "ë„ì–´6";
                case 'H0': return "ë¯¸ë‹«ì´";
                case 'HA': return "ë¯¸ë‹«ì´1";
                case 'HB': return "ë¯¸ë‹«ì´2";
                case 'HC': return "ë¯¸ë‹«ì´3";
                case 'HD': return "ë¯¸ë‹«ì´4";
                case 'HE': return "ë¯¸ë‹«ì´5";
                case 'HF': return "ë¯¸ë‹«ì´6";
                case 'I0': return "ë²™ì»¤";
                case 'IA': return "ë²™ì»¤1";
                case 'IB': return "ë²™ì»¤2";
                case 'IC': return "ë²™ì»¤3";
                case 'ID': return "ë²™ì»¤4";
                case 'IE': return "ë²™ì»¤5";
                case 'IF': return "ë²™ì»¤6";
                case 'Z0': return "ê¸°íƒ€";
                case 'Z1': return "ê¸°íƒ€1";
                case 'Z2': return "ê¸°íƒ€2";
                case 'Z3': return "ê¸°íƒ€3";
                case 'Z4': return "ê¸°íƒ€4";
                case 'Z5': return "ê¸°íƒ€5";
                case 'Z6': return "ê¸°íƒ€6";
                default: return " "; // ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš° ê¸°ë³¸ê°’
            }
        }

        //`cgrb` ì½”ë“œë³„ë¡œ ì´ë¦„ë§Œ ë§¤í•‘í•œ ê°ì²´
        const cgrbMapping = {
            "MAA": "AL",
            "MAB": "GI",
            "MAC": "GRP",
            "MAD": "GFGW",
            "MAE": "GFGW(B)",
            "MAF": "H-GRO",
            "MAG": "Anti-Bac",
            "MAH": "Anti-Slip",
            "MAI": "SUS",
            "MAZ": "ê¸°íƒ€",
            "MBA": "ê³¨ë“œí¼",
            "MCA": "í•©íŒ",
            "MCB": "ì½”ì–´ë§¤íŠ¸",
            "MDA": "ì£¼ì œ",
            "MDB": "ê²½í™”ì œ",
            "MAK": "Super Plus",
            "MCF": "WPC",
            "MBB": "PUë³´ë“œ",
            "MAJ": "GI(B)",
            "MAS": "Super Lite",
            "MCG": "í—ˆë‹ˆì»´",
            "MCC": "ì•„ë§ˆì…€",
            "MCD": "LTPë³´ë“œ",
            "MCE": "ê¸°íƒ€",
            "MBI": "ì•„ì´ì†Œí•‘í¬",
            "MAM": "CFRT",
            "MAL": "WR-Impact",
            "ZZ01": "ìƒ·ì‹œ",
            "ZZ02": "ìºìŠ¤íŒ…",
            "ZZ03": "ì•µê¸€",
            "ZZ04": "ì›ìì¬",
            "ZZ05": "CKD",
            "ZZ06": "ê¸°íƒ€",
            "ZZ07": "ì½”ì¼"
        };

        // `getListCgrb` í•¨ìˆ˜ì—ì„œ `cgrb` ì½”ë“œì— ë”°ë¼ ì´ë¦„ì„ ë°˜í™˜
        function getListCgrb(cgrb) {
            return cgrbMapping[cgrb] || " "; // ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜
        }

        /*ëª¨ë‹¬ì°½=====================================================*/

        // ì—”í„° í‚¤ë¥¼ ëˆŒë €ì„ ë•Œ ëª¨ë‹¬ì„ ì—¬ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.getElementById('searchCltnm').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                console.log('Enter key pressed, showing CltnmModal...');
                showPopupById('CltnmModal');  // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ í˜¸ì¶œ
                modalGrid();  // ëª¨ë‹¬ ê·¸ë¦¬ë“œ ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ
            }
        });

        // ëª¨ë‹¬ IDì™€ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ë¥¼ ë§¤í•‘í•˜ëŠ” ê°ì²´
        const modalDataLoaders = {
            'CltnmModal': modalDeta,
            'OrdtextModal':showOrdtextModal,
        };

        function showPopupById(popupId, rowIndex = null) {
            const popup = document.getElementById(popupId);
            if (popup) {
                const modal = popup.closest('.modal');
                if (modal) {
                    modal.style.display = 'block';
                    requestAnimationFrame(() => modal.classList.add('show'));
                }
                popup.style.display = 'block';
                requestAnimationFrame(() => popup.classList.add('show'));

                // ëª¨ë‹¬ì´ ì—´ë¦¬ë©´ì„œ í•´ë‹¹ ëª¨ë‹¬ì˜ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ
                const loadDataFunction = modalDataLoaders[popupId];
                if (typeof loadDataFunction === 'function') {
                    try {
                        // rowIndexê°€ í•„ìš”í•  ê²½ìš°ì—ë§Œ ì „ë‹¬
                        if (popupId === 'OrdtextModal' && rowIndex !== null) {
                            loadDataFunction(rowIndex);
                        } else {
                            loadDataFunction();
                        }
                    } catch (error) {
                        console.error(`Error loading data for modal '${popupId}':`, error);
                    }
                } else {
                    console.log(`No data load function defined for modal with ID: ${popupId}`);
                }

                console.log(`Showing modal with ID: ${popupId}`);
            } else {
                console.warn(`Popup with ID '${popupId}' not found.`);
            }
        }

        function showOrdtextModal(rowIndex) {
            console.log("showOrdtextModal called with rowIndex:", rowIndex);

            // rowIndexê°€ ìœ íš¨í•œì§€ ê²€ì¦
            if (rowIndex === undefined || rowIndex === null || !theGrid2 || !theGrid2.rows[rowIndex]) {
                console.error("Invalid rowIndex or theGrid2 is not defined:", rowIndex);
                return;
            }

            const selectedData = theGrid2.rows[rowIndex].dataItem;
            console.log("Selected data from grid:", selectedData);

            if (selectedData && selectedData.originalOrdtext) {
                tinymce.get("ordtext").setContent(selectedData.originalOrdtext);
                console.log("Ordtext loaded into TinyMCE editor");
            } else {
                console.error("ì„ íƒí•œ í–‰ì— ëŒ€í•´ ì›ë³¸ ì£¼ë¬¸ í…ìŠ¤íŠ¸ ë°ì´í„°ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");
            }
        }

        // ëª¨ë‹¬ì„ ë‹«ëŠ” í•¨ìˆ˜
        function closePopup(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) {
                const modal = popup.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                    modal.classList.remove('show');
                }
                popup.style.display = 'none';
                popup.classList.remove('show');
                console.log(`Closing modal with ID: ${popupId}`);
            }
        }

       /*ëª¨ë‹¬ ë ============================================================*/

        function modalDeta() {
            console.log('Initializing modal grid...');
            const Modaldata = [];
            const minimumRows = 13;

            // searchTermì„ ì…ë ¥ í•„ë“œì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤ (ì˜ˆ: #searchCltnm)
            const searchTerm = $('#searchCltnm').val();

            $.ajax({
                url: '/api/order_status/ModalRead',
                type: 'GET',
                data: { searchTerm: searchTerm }, // searchTermì„ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€
                async: true,
                success: function(response) {
                    if (response && Array.isArray(response.data)) {
                        response.data.forEach((item, index) => {
                            Modaldata.push({
                                rownum: index + 1,  // ìˆœë²ˆì„ ì¶”ê°€
                                ...item
                            });
                        });
                    }

                    // ìµœì†Œ í–‰ ìˆ˜ ì±„ìš°ê¸°
                    if (Modaldata.length < minimumRows) {
                        for (let i = Modaldata.length; i < minimumRows; i++) {
                            Modaldata.push({
                                rownum: i + 1,
                                cltcd: '',
                                cltnm: '',
                                telnum: '',
                                cltadres: ''
                            });
                        }
                    }

                    // ë””ë²„ê¹…: ë°ì´í„° í™•ì¸
                    console.log("Data length after adding empty rows:", Modaldata.length);

                    // ë°ì´í„°ë¥¼ CollectionViewì— ë°”ì¸ë”©
                    const viewdata = new wijmo.collections.CollectionView(Modaldata);

                    // ê¸°ì¡´ ê·¸ë¦¬ë“œ ì œê±° í›„ ìƒˆë¡œ ìƒì„±
                    if (modalGrid) {
                        modalGrid.dispose();
                    }

                    modalGrid = new wijmo.grid.FlexGrid('#modalGrid', {
                        autoGenerateColumns: false,
                        isReadOnly: true,
                        columns: [
                            {binding: 'rownum', header: 'ìˆœë²ˆ', width: 50, align: 'center'},
                            {binding: 'cltcd', header: 'ì½”ë“œ', width: 140, minWidth: 80, align: 'center'},
                            {binding: 'cltnm', header: 'ê±°ë˜ì²˜ëª…', width: 250 },
                            {binding: 'telnum', header: 'ì „í™”', width: 250},
                            {binding: 'cltadres', header: 'ì£¼ì†Œ', width: '*'}
                        ],
                        itemsSource: viewdata
                    });
                    modalGrid.rowHeaders.columns.splice(0, 1);
                    console.log('Modal grid initialized and data loaded.');

                    // ê·¸ë¦¬ë“œì˜ ë”ë¸” í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                    let lastClickTime = 0;
                    modalGrid.hostElement.addEventListener('click', function (e) {
                        const now = new Date().getTime();

                        if (now - lastClickTime < 300) { // 300ms ì´ë‚´ì˜ ë‘ ë²ˆ í´ë¦­ì€ ë”ë¸” í´ë¦­ìœ¼ë¡œ ì¸ì‹
                            // í´ë¦­ëœ ìœ„ì¹˜ì˜ í–‰ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°
                            const ht = modalGrid.hitTest(e);

                            if (ht.cellType === wijmo.grid.CellType.Cell) {
                                const clickedItem = modalGrid.rows[ht.row].dataItem;

                                if (clickedItem && clickedItem.cltnm) { // í´ë¦­ëœ í–‰ì— 'cltnm' ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                                    $('#searchCltnm').val(clickedItem.cltnm); // ê²€ìƒ‰ í•„ë“œì— ì—…ì²´ ì´ë¦„ ì„¤ì •
                                }

                                // ì›í•˜ëŠ” ê¸°ëŠ¥ ì‹¤í–‰
                                searchData(); // ë”ë¸” í´ë¦­ ì‹œ ì›í•˜ëŠ” í•¨ìˆ˜ ì‹¤í–‰
                                closePopup('CltnmModal'); // ëª¨ë‹¬ ì°½ ë‹«ê¸°
                            }
                        }

                        lastClickTime = now;
                    });
                },
                error: function() {
                    console.error("Error fetching modal data.");
                }
            });
        }

        function resetForm() {
            // ê²€ìƒ‰ ê´€ë ¨ í•„ë“œ ì´ˆê¸°í™” (ì¼ë°˜ í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ)
            const searchInputIds = [
                'searchCltnm', 'searchtketnm'
            ];

            searchInputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.value = ''; // í…ìŠ¤íŠ¸ í•„ë“œë¥¼ ë¹ˆ ë¬¸ìì—´ë¡œ ì´ˆê¸°í™”
                }
            });

            // ë“œë¡­ë‹¤ìš´ í•„ë“œ ì´ˆê¸°í™”
            const dropdown = document.getElementById('searchstate');
            if (dropdown) {
                dropdown.value = 'ì „ì²´'; // ë“œë¡­ë‹¤ìš´ì„ ê¸°ë³¸ê°’('ì „ì²´')ìœ¼ë¡œ ì„¤ì •
            }
        }
        function initDatas(){
            $('.requestCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
            $('.checkCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
            $('.estimateCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
            $('.produceCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
            $('.deliveryCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
            $.ajax({
                url: '/api/order_status/initDatas',
                type: 'GET',
                data: {
                    'search_spjangcd': $('#search_spjangcd').val(),
                    'search_startDate': $('#startDate2').val(),
                    'search_endDate': $('#endDate2').val(),
                },
                async: false,
                success: function (data) {
                    data2 = data.data;
                    data2.forEach(item =>{
                        switch (item.ordflag) {
                            case "0":
                                $('.requestCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                                break;
                            case "1":
                                $('.checkCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                                break;
                            case "2":
                                $('.estimateCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                                break;
                            case "3":
                                $('.produceCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                                break;
                            case "4":
                                $('.deliveryCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                                break;
                            default:
                                console.log("ì£¼ë¬¸í˜„í™© ë°”ì¸ë“œ ì˜¤ë¥˜ : ", item.ordflag);
                        }
                    })
                }
            })
        }
        function bindSpjangcd() {
            $.ajax({
                url: '/api/dashboard2/bindSpjangcd',
                type: 'GET',
                async: false,
                success: function (data) {
                    data2 = data.data;
                    const selectElement = document.getElementById('search_spjangcd');
                    if (selectElement) {
                        selectElement.value = data2; // value ì†ì„±ìœ¼ë¡œ ì„ íƒ
                    }
                }
            })
        }

        function openPopup(url) {
            // ìƒˆ ì°½ ì—´ê¸°
            window.open(url, '_blank',
                'width=1040,height=1000,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes');
        }

        //ì£¼ë¬¸ í™•ì¸
        function CheckOK() {
            let selectedRows = [];

            if (theGrid2) {
                let selector = new wijmo.grid.selector.Selector(theGrid2);

                if (typeof selector.getCheckedItems === "function") {
                    selectedRows = selector.getCheckedItems();
                } else {
                    console.warn("âš ï¸ `getCheckedItems()`ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. `isSelected` ë°©ì‹ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.");
                    selectedRows = theGrid2.rows.filter(row => row.isSelected).map(row => row.dataItem);
                }
            }

            if (selectedRows.length === 0) {
                alert("ì„ íƒëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // âœ… ì„ íƒëœ í–‰ ë°ì´í„° ì½˜ì†”ì— ì¶œë ¥
            console.log("âœ… ì„ íƒëœ ì£¼ë¬¸ ë°ì´í„°:", selectedRows);

            processSelectedOrders(selectedRows);
        }

        function processSelectedOrders(selectedRows) {
            let requestData = { orders: selectedRows };

            console.log(" ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„°:", JSON.stringify(requestData));

            $.ajax({
                url: '/api/order_status/confirm',
                type: 'POST',
                contentType: 'application/json', // âœ… JSON í—¤ë” ì¶”ê°€
                data: JSON.stringify(requestData), // âœ… JSON í˜•ì‹ ë³€í™˜
                headers: {
                    'X-CSRF-Token': $('[name=_csrf]').val()
                },
                success: function(response) {
                    console.log("âœ… ì„œë²„ ì‘ë‹µ:", response);
                    Alert.alert('' ,"ì£¼ë¬¸ í™•ì¸ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    fetchListData2();
                },
                error: function(xhr, status, error) {
                    console.error("âŒ ì£¼ë¬¸ í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", xhr.responseText);

                    try {
                        let response = JSON.parse(xhr.responseText);
                        Alert.alert('', response.message || "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    } catch (e) {
                        Alert.alert('', "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    }
                }

            });
        }

        //ê³µí†µ ì½”ë“œ
        const selectConfigs = [
            { parentCode: 'ordflag', elementId: 'searchstate' },
        ];

        selectConfigs.forEach(config => {
            initializeSelect3({
                url: '/api/order_status/ordFlagType',
                params: { parentCode: config.parentCode },
                elementId: config.elementId,
                valueField: "code",
                textField: "value",
                includeAllOption: true, // "ì „ì²´" ì˜µì…˜ ì‚¬ìš©
                defaultValue: "0" // âœ… ê¸°ë³¸ ì„ íƒê°’ ì¶”ê°€ ("ì£¼ë¬¸ë“±ë¡")
            });
        });

    </script>
</th:block>
</html>

