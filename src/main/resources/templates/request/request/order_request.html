<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<style>

</style>
<th:block layout:fragment="content">

  <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
  <div class="layout-contents">
    <!-- Page Title -->
    <div class="page-title-wrap">
      <div class="left">
        <h2>ì£¼ë¬¸ ê´€ë¦¬</h2>
        <!--                <a href="#" title="ë¶ë§ˆí¬" class="bookmark toggle">-->
        <!--                    ë‚´ë©”ë‰´-->
        <!--                </a>-->
      </div>
      <ul class="page-navi">
        <li><img src="/images/icon/ico-nav-home.svg" alt="í™ˆì•„ì´ì½˜"></li>
        <li>ì£¼ë¬¸ ê´€ë¦¬</li>
        <li>ì£¼ë¬¸ ë“±ë¡</li>
      </ul>
    </div>
    <!-- Select -->

    <div class="tab-wrap">
      <ul class="tab-links">
        <input type="hidden" id="checkdtParam" name="checkdtParam" th:value="${checkdt}"/>
        <li>
          <a href="#tab1" title="ëª©ë¡" id="listTabLink">ì£¼ë¬¸ ë“±ë¡</a>
        </li>
        <li>
          <a href="#tab2" title="ë“±ë¡">ì£¼ë¬¸/ì§„í–‰í˜„í™©</a>
        </li>
      </ul>
      <div class="tab-contents">
        <!--      ì£¼ë¬¸ë“±ë¡ íƒ­ ì‹œì‘       -->
        <!-- Section -->
        <section class="tab-item" id="tab1">
          <div class="section-top">
            <div class="title-wrap">
              <h3>ì£¼ë¬¸ë“±ë¡</h3>
              <img src="/images/icon/exclamation/exclamation-circle.svg"
                   class="zoom-img" style="margin-left: 5px"
                   onclick="openPopup('https://foms.atlassian.net/wiki/external/YzNmYmE3MTkyYTFlNGU2OGIwOTY5YTEyNDFiZjcwZmE')" alt="ë„ì›€ë§">
            </div>
            <div class="button-wrap">
              <ul>
                <li>
                  <a class="btn btn-excell" title="ì‹ ê·œë“±ë¡" onclick="resetFormFields()">
                    <img src="/images/icon/ico-plus.svg" alt="ë“±ë¡ ì•„ì´ì½˜">
                    ì‹ ê·œë“±ë¡
                  </a>
                </li>
                <li>
                  <a class="btn btn-file2" title="íŒŒì¼ ì²¨ë¶€" data-popup="popup1"
                     onclick="showPopup(this)">
                    íŒŒì¼ ì²¨ë¶€<span>(0)</span>
                  </a>
                </li>
                <li>
                  <a class="btn btn-delete" id="deleteButton" title="ì‚­ì œ">
                    <img src="/images/icon/ico-delete.svg" alt="ì‚­ì œ ì•„ì´ì½˜">
                    ì‚­ì œ
                  </a>
                </li>
                <li>
                  <a class="btn btn-edit" id="btnSave" title="ì €ì¥" onclick="saveOrder()">
                    <img src="/images/icon/ico-save.svg" alt="ì €ì¥ ì•„ì´ì½˜">
                    ì €ì¥
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="table-wrap">
            <table class="write-table">
              <caption>ì£¼ë¬¸ë“±ë¡ í…Œì´ë¸”</caption>
              <input type="hidden" id="reqnum" name="reqnum">
              <tbody>
              <tr>
                <th style="text-align: center">
                  <label for="reqdate">
                    ì£¼ë¬¸ì¼ì
                  </label>
                </th>
                <td>
                  <input type="date" id="reqdate" name="reqdate" value="" style="width: 200px">
                </td>
                <th style="text-align: center">
                  <label for="deldate">
                    ë‚©í’ˆí¬ë§ì¼
                  </label>
                </th>
                <td>
                  <input type="date" id="deldate" name="deldate" style="width: 200px">
                </td>
                <th style="text-align: center">
                  <label for="telno">
                    ì—°ë½ì²˜
                  </label>
                </th>
                <td colspan="3">
                  <input type="text" id="telno" name="telno">
                </td>
              </tr>
              <tr>
                <th style="text-align: center">
                  <label for="perid">
                    ë‹´&ensp;ë‹¹&ensp;ì
                  </label>
                </th>
                <td>
                  <input type="text" id="perid" name="perid" style="width: 200px">
                </td>
                <th style="text-align: center">
                  <label for="postno">
                    ì£¼&ensp;&ensp;&ensp;&ensp;&ensp;ì†Œ
                  </label>
                </th>
                <td colspan="5">
                  <input type="text" id="postno" placeholder="ìš°í¸ë²ˆí˜¸"
                         onclick="sample4_execDaumPostcode()"
                         style="width: 100px; margin-bottom: 3px;">
                  <input type="text" id="address1" placeholder="ë„ë¡œëª…ì£¼ì†Œ" style="width: 48%">
                  <input type="hidden" id="placeAddress" placeholder="ì§€ë²ˆì£¼ì†Œ">
                  <span id="guide" style="color:#999;display:none"></span>
                </td>
              </tr>
              <tr>
                <th style="text-align: center">
                  <label for="panel_ht">
                    ë‘&ensp;&ensp;&ensp;&nbsp;ê»˜
                  </label>
                </th>
                <td>
                  <input type="number" id="panel_ht" name="panel_ht" style="width: 200px">
                </td>
                <th style="text-align: center">
                  <label for="panel_hw">
                    í­
                  </label>
                </th>
                <td>
                  <input type="number" id="panel_hw" name="panel_hw" style="width: 200px">
                </td>
                <th style="text-align: center">
                  <label for="panel_hl">
                    ê¸¸&ensp;&ensp;ì´
                  </label>
                </th>
                <td>
                  <input type="number" id="panel_hl" name="panel_hl" style="width: 200px">
                </td>
                <th style="text-align: center">
                  <label for="panel_hh">
                    ë†’&ensp;&ensp;ì´
                  </label>
                </th>
                <td>
                  <input type="number" id="panel_hh" name="panel_hh" style="width: 200px">
                </td>
              </tr>
              <tr>
                <th style="text-align: center">
                  <label for="remark">
                    ì œ&ensp;&ensp;&ensp;&nbsp;ëª©
                    <br>
                    <small style="font-size: 0.85em; color: #666;">(ë©”&ensp;&ensp;&ensp;ëª¨)</small>
                  </label>
                </th>
                <td colspan="7">
                  <input type="text" id="remark" name="remark" style="width: 62%">
                </td>
              </tr>
              </tbody>
            </table>
          </div>
          <div class="section-top">
            <div class="title-wrap">
              <h3>ì„¸ë¶€ì‚¬í•­</h3>
            </div>
            <div class="button-wrap" style="margin-bottom: 10px; margin-top: 10px">
              <ul>
                <li>
                  <a class="btn btn-saverow" id="btn-saverow" name="saverow" title="ì„¸ë¶€ì‚¬í•­ ì¶”ê°€" onclick="addBody()">
                    <img src="/images/icon/ico-plus.svg" alt="ë“±ë¡ ì•„ì´ì½˜">
                    ì„¸ë¶€ì‚¬í•­ ì¶”ê°€
                  </a>
                </li>
                <li>
                  <a class="btn btn-saverow" id="btn-addrow" name="addrow" title="í–‰ ë³µì‚¬" onclick="copyLastRow()">
                    <img src="/images/icon/ico-edit.svg" alt="ë“±ë¡ ì•„ì´ì½˜">
                    í–‰ ë³µì‚¬
                  </a>
                </li>
                <li>
                  <a class="btn btn-deleterow" id="btn-deleterow" name="deleterow" title="í–‰ì‚­ì œ" onclick="deleteBody()">
                    <img src="/images/icon/ico-delete.svg" alt="ì‚­ì œ ì•„ì´ì½˜">
                    í–‰ ì‚­ì œ
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="table-wrap">
            <table class="write-table">
              <caption>ì„¸ë¶€ì‚¬í•­ í…Œì´ë¸”</caption>
              <input type="hidden" id="reqseq" name="reqseq">
              <input type="hidden" id="isnew" name="isnew">
              <tbody>
              <tr>
                <th style="text-align: center">
                  <label for="hgrb">
                    ì œí’ˆêµ¬ì„±
                  </label>
                </th>
                <td>
                  <select id="hgrb" name="hgrb" style="width: 100px" onchange="changeHgrb()">
                    <option value="" selected disabled>ì„ íƒ</option>
                  </select>
                </td>
                <th style="text-align: center">
                  <label for="qty">
                    ìˆ˜&ensp;ëŸ‰
                  </label>
                </th>
                <td>
                  <input type="number" id="qty" name="qty" style="width: 100px">
                </td>
                <th style="text-align: center">
                  <label for="panel_t">
                    T (ë‘ê»˜)
                  </label>
                </th>
                <td>
                  <input type="number" id="panel_t" name="panel_t" style="width: 100px">
                </td>
                <th style="text-align: center">
                  <label for="panel_w">
                    W/H (í­ ë˜ëŠ” ë†’ì´)
                  </label>
                </th>
                <td>
                  <input type="number" id="panel_w" name="panel_w" style="width: 100px">
                </td>

                <th style="text-align: center">
                  <label for="panel_l">
                    L (ê¸¸ì´)
                  </label>
                </th>
                <td>
                  <input type="number" id="panel_l" name="panel_l" style="width: 100px">
                </td>
              </tr>
              <tr>
                <th style="text-align: center">
                  <label for="exfmtypedv">
                    ì™¸ë¶€ë§ˆê°ì¬
                  </label>
                </th>
                <td>
                  <select id="exfmtypedv" name="exfmtypedv" style="width: 100px">
                    <option value="" selected>ì—†ìŒ</option>
                    <option value="MAC">GRP</option>
                    <option value="MAA">AL</option>
                    <option value="MAB">GI</option>
                    <option value="MAI">SUS</option>
                    <option value="MAZ">ê¸°íƒ€</option>
                  </select>
                </td>
                <th style="text-align: center">
                  <label for="infmtypedv">
                    ì™¸ë¶€ë³´ê°•ì¬
                  </label>
                </th>
                <td>
                  <select id="infmtypedv" name="infmtypedv" style="width: 100px">
                    <option value="" selected>ì—†ìŒ</option>
                    <option value="MCA">í•©íŒ</option>
                    <option value="MCD">LTP</option>
                    <option value="MCE">ê¸°íƒ€</option>
                  </select>
                </td>
                <th style="text-align: center">
                  <label for="stframedv">
                    ë‚´ë¶€ë³´ê°•ì¬
                  </label>
                </th>
                <td>
                  <select id="stframedv" name="stframedv" style="width: 100px">
                    <option value="" selected>ì—†ìŒ</option>
                    <option value="MCA">í•©íŒ</option>
                    <option value="MCD">LTP</option>
                    <option value="MCE">ê¸°íƒ€</option>
                  </select>
                </td>
                <th style="text-align: center">
                  <label for="stexplydv">
                    ë‚´ë¶€ë§ˆê°ì¬
                  </label>
                </th>
                <td>
                  <select id="stexplydv" name="stexplydv" style="width: 100px">
                    <option value="" selected>ì—†ìŒ</option>
                    <option value="MAC">GRP</option>
                    <option value="MAA">AL</option>
                    <option value="MAB">GI</option>
                    <option value="MAI">SUS</option>
                    <option value="MAZ">ê¸°íƒ€</option>
                  </select>
                </td>
                <th style="text-align: center">
                  <label for="ordtext">
                    ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­
                  </label>
                </th>
                <td>
                  <a class="btn btn-request" title="ìš”ì²­ì‚¬í•­" data-popup="popup2"
                     onclick="showPopup(this)">
                    ìš”ì²­ì‚¬í•­ ì‘ì„±
                  </a>
                </td>
              </tr>
              </tbody>
            </table>
            <div class="container-fluid">
              <p id=""></p>
              <div id="theGrid2" style="max-height: 714px; height: 300px"></div>
            </div>
          </div>
        </section>
        <!--       ì£¼ë¬¸ë“±ë¡ íƒ­ ì¢…ë£Œ   / ì£¼ë¬¸ ì˜ë¢°í˜„í™© ì‹œì‘       -->
        <!-- Section -->
        <section class="tab-item" id="tab2" style="height: 832px;">
          <div class="section-top">
            <div class="search-wrap">
              <dl>
                <dt>
                  ì£¼ë¬¸ì¼ì<span class="eq">*</span>
                  <img src="/images/icon/exclamation/exclamation-circle.svg"
                       class="zoom-img" style="margin-left: 5px"
                       onclick="openPopup('https://foms.atlassian.net/wiki/external/Zjc1ZjNiZTFjYzJjNGI4ZjliMTE0ODVlNTAyZWFhZTU')" alt="ë„ì›€ë§">
                </dt>
                <dd>
                  <ul class="date-box">
                    <li>
                      <input type="date" id="startDate" name="startDate">
                      <label for="startDate" class="hide">ì‹œì‘ì¼</label>
                    </li>
                    <li>
                      <input type="date" id="endDate" name="endDate">
                      <label for="endDate" class="hide">ì¢…ë£Œì¼</label>
                    </li>
                  </ul>
                </dd>
              </dl>
              <dl>
                <dt>
                  <label for="searchRemark">
                    ì œëª©<span class="eq">*</span>
                  </label>
                </dt>
                <dd>
                  <div class="srch-box">
                    <input type="text" id="searchRemark" name="searchRemark" class="input-srch"
                           placeholder="ì œëª©" style="border-radius: 5px;">
                    <!--                                        <a href="#a" class="btn-srch" title="ê²€ìƒ‰" onclick="searchData()"></a>-->
                  </div>
                </dd>
              </dl>
              <dl>
                <dt>
                  <label for="searchOrdflag">
                    ì§„í–‰êµ¬ë¶„<span class="eq">*</span>
                  </label>
                </dt>
                <dd>
                  <div class="srch-box">
                    <select id="searchOrdflag" name="searchOrdflag">
                      <option value="">ì „ì²´</option>
                      <option value="0">ì£¼ë¬¸ë“±ë¡</option>
                      <option value="1">ì£¼ë¬¸í™•ì¸</option>
                      <option value="2">ì£¼ë¬¸í™•ì •</option>
                      <option value="3">ì œì‘ì§„í–‰</option>
                      <option value="4">ì¶œê³ </option>
                    </select>
                    <!--                                        <a href="#a" class="btn-srch" title="ê²€ìƒ‰" onclick="searchData()"></a>-->
                  </div>
                </dd>
              </dl>
              <dl>
                <dt>&nbsp;</dt>
                <dd>
                  <li>
                    <a class="btn btn-delete" title="ê²€ìƒ‰" id="searchButton1" onclick="fetchListData()">
                      <!--                                        class ì“°ì´ëŠ” ê³³ ì°¾ê³  ì—†ìœ¼ë©´ í´ë˜ìŠ¤ëª… ìˆ˜ì •í•˜ê¸°-->
                      <img src="/images/icon/btn-srch.svg" alt="ê²€ìƒ‰ ì•„ì´ì½˜">
                      ê²€ìƒ‰
                    </a>
                  </li>
                </dd>
              </dl>
            </div>
          </div>
          <div class="container-fluid">
            <p id="selectedItem"></p>
            <div id="theGrid" style="max-height: 714px"></div>
          </div>
        </section>
        <!--      ì£¼ë¬¸ ì˜ë¢° í˜„í™© ì¢…ë£Œ          -->
      </div> <!--//tab-contens end-->
    </div> <!--//tab-wrap end-->
  </div> <!--//layout-contents end -->
  <footer style="margin-top:5px;">
    <p>Copyrightâ“’ 0000 corp. All rights reserved.</p>
  </footer>
  <div style="height: 10px"></div>

  <div class="modal">
    <div class="popup-wrapper w700" id="popup1">
      <div class="popup-title">
        <h3>íŒŒì¼ ì—…ë¡œë“œ</h3>
        <a title="íŒì—…ë‹«ê¸°" onclick="closePopup('popup1')" class="btn-popup-close">
          <img src="/images/icon/btn-popup-close.svg" alt="ë‹«ê¸°">
        </a>
      </div>
      <div class="popup-contents">
        <div class="table-wrap">
          <table class="write-table">
            <caption>ì „ê¸°ì•ˆì „ ì ê²€ ì²¨ë¶€íŒŒì¼</caption>
            <colgroup>
              <col class="wp20">
              <col class="wp80">
            </colgroup>
            <tbody>
            <tr>
              <th>
                ì²¨ë¶€íŒŒì¼
              </th>
              <td>
                <div id="uploadComponent2" class="upload-component2">
                  <div class="upload-filebox2">
                    <img src="/images/icon/ico-fileupload.svg" alt="ì—…ë¡œë“œì•„ì´ì½˜">
                    <a class="btn" title="íŒŒì¼ì—…ë¡œë“œ">íŒŒì¼ ì—…ë¡œë“œ</a>
                    <input type="file" id="fileInput2" class="fileInput2" multiple>
                    <p>Maximun upload file size <span>1GiB</span></p>
                  </div>

                  <div class="upload-filelist2">
                    <div class="title">
                      <h5>Files (0)</h5>
                      <a title="Delete all" class="btn-file-deleteall2">Delete all</a>
                    </div>
                    <ul class="filelist2" id="filelist2">
                    </ul>
                  </div>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="popup-button">
          <button type="button" onclick="closePopup('popup1')" class="btn-navy">í™•ì¸</button>
        </div>
      </div>
    </div>
  </div>
  <!--ìš”ì²­ì‚¬í•­ popup -->
  <div class="modal">
    <div class="popup-wrapper w700" id="popup2" style="min-width: 1050px">
      <div class="popup-title">
        <h3>ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­</h3>
        <a title="íŒì—…ë‹«ê¸°" onclick="closePopup('popup2')" class="btn-popup-close">
          <img src="/images/icon/btn-popup-close.svg" alt="ë‹«ê¸°">
        </a>
      </div>
      <div class="popup-contents">
        <div class="table-wrap">
          <table class="write-table" style="border-top: 0px;">
            <caption>ì£¼ë¬¸ë“±ë¡ ìš”ì²­ì‚¬í•­</caption>
            <colgroup>
              <col class="wp20">
              <col class="wp80">
            </colgroup>
            <tbody>
            <tr>
              <td>
                <div class="table-wrap">
                  <table class="write-table">
                    <caption>ìš”ì²­ì‚¬í•­</caption>
                    <tbody>
                    <tr style="align-items: center">
                      <th>
                        <label for="ordtext">
                          ë‚´ìš©
                        </label>
                      </th>
                      <td colspan="3">
                        <div class="textarea-box">
                          <textarea id="ordtext"></textarea>
                          <!--<p class="text-count" id="text-count">0/100</p>-->
                        </div>
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="popup-button">
          <button type="button" onclick="endtext('popup2')" class="btn-navy">ì‘ì„±ì™„ë£Œ</button>
        </div>
      </div>
    </div>
  </div>
</th:block>

<th:block layout:fragment="scripts">
  <th:block th:replace="/common/columns_setting :: columns_setting"></th:block>
  <script>
    tinymce.init({
      language: "ko_KR",
      selector: "#ordtext",
      plugins: "paste image imagetools",
      height: 500,
      width: 900,
      toolbar: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | image",
      paste_data_images: false,
      file_picker_types: 'image',
      automatic_uploads: false, // ìë™ ì—…ë¡œë“œ ë¹„í™œì„±í™”

      // íŒŒì¼ ì„ íƒê¸° ì½œë°±
      file_picker_callback: function (callback, value, meta) {
        if (meta.filetype === 'image') {
          const input = document.createElement('input');
          input.setAttribute('type', 'file');
          input.setAttribute('accept', 'image/*');

          input.onchange = function () {
            const file = input.files[0];
            if (file) {
              const formData = new FormData();
              formData.append('file', file);

              // ì—…ë¡œë“œ ìš”ì²­
              fetch('/api/request/request/uploadEditor', {
                method: 'POST',
                body: formData,
                headers: {
                  'X-CSRF-Token': csrfToken // CSRF í† í° ì¶”ê°€
                }
              })
                      .then(response => response.json())
                      .then(data => {
                        if (data.location) {
                          // ì—…ë¡œë“œëœ URLì„ ì—ë””í„°ì— ì‚½ì…
                          callback(data.location, { alt: file.name });
                        }
                      })
                      .catch(error => {
                        console.error('Image upload failed:', error);
                        alert('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                      });
            }
          };

          input.click(); // íŒŒì¼ íƒìƒ‰ê¸° ì—´ê¸°
        }
      }
    });
  </script>
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script>
    //ë³¸ ì˜ˆì œì—ì„œëŠ” ë„ë¡œëª… ì£¼ì†Œ í‘œê¸° ë°©ì‹ì— ëŒ€í•œ ë²•ë ¹ì— ë”°ë¼, ë‚´ë ¤ì˜¤ëŠ” ë°ì´í„°ë¥¼ ì¡°í•©í•˜ì—¬ ì˜¬ë°”ë¥¸ ì£¼ì†Œë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.
    function sample4_execDaumPostcode() {
      new daum.Postcode({
        oncomplete: function (data) {
          // íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„.

          // ë„ë¡œëª… ì£¼ì†Œì˜ ë…¸ì¶œ ê·œì¹™ì— ë”°ë¼ ì£¼ì†Œë¥¼ í‘œì‹œí•œë‹¤.
          // ë‚´ë ¤ì˜¤ëŠ” ë³€ìˆ˜ê°€ ê°’ì´ ì—†ëŠ” ê²½ìš°ì—” ê³µë°±('')ê°’ì„ ê°€ì§€ë¯€ë¡œ, ì´ë¥¼ ì°¸ê³ í•˜ì—¬ ë¶„ê¸° í•œë‹¤.
          var roadAddr = data.roadAddress; // ë„ë¡œëª… ì£¼ì†Œ ë³€ìˆ˜
          var extraRoadAddr = ''; // ì°¸ê³  í•­ëª© ë³€ìˆ˜

          // ë²•ì •ë™ëª…ì´ ìˆì„ ê²½ìš° ì¶”ê°€í•œë‹¤. (ë²•ì •ë¦¬ëŠ” ì œì™¸)
          // ë²•ì •ë™ì˜ ê²½ìš° ë§ˆì§€ë§‰ ë¬¸ìê°€ "ë™/ë¡œ/ê°€"ë¡œ ëë‚œë‹¤.
          if (data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)) {
            extraRoadAddr += data.bname;
          }
          // ê±´ë¬¼ëª…ì´ ìˆê³ , ê³µë™ì£¼íƒì¼ ê²½ìš° ì¶”ê°€í•œë‹¤.
          if (data.buildingName !== '' && data.apartment === 'Y') {
            extraRoadAddr += (extraRoadAddr !== '' ? ', ' + data.buildingName : data.buildingName);
          }
          // í‘œì‹œí•  ì°¸ê³ í•­ëª©ì´ ìˆì„ ê²½ìš°, ê´„í˜¸ê¹Œì§€ ì¶”ê°€í•œ ìµœì¢… ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
          if (extraRoadAddr !== '') {
            extraRoadAddr = ' (' + extraRoadAddr + ')';
          }

          // ìš°í¸ë²ˆí˜¸ì™€ ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
          document.getElementById('postno').value = data.zonecode;
          document.getElementById("address1").value = roadAddr;
          document.getElementById("placeAddress").value = data.jibunAddress;

          var guideTextBox = document.getElementById("guide");
          // ì‚¬ìš©ìê°€ 'ì„ íƒ ì•ˆí•¨'ì„ í´ë¦­í•œ ê²½ìš°, ì˜ˆìƒ ì£¼ì†Œë¼ëŠ” í‘œì‹œë¥¼ í•´ì¤€ë‹¤.
          if (data.autoRoadAddress) {
            var expRoadAddr = data.autoRoadAddress + extraRoadAddr;
            guideTextBox.innerHTML = '(ì˜ˆìƒ ë„ë¡œëª… ì£¼ì†Œ : ' + expRoadAddr + ')';
            guideTextBox.style.display = 'block';

          } else if (data.autoJibunAddress) {
            var expJibunAddr = data.autoJibunAddress;
            guideTextBox.innerHTML = '(ì˜ˆìƒ ì§€ë²ˆ ì£¼ì†Œ : ' + expJibunAddr + ')';
            guideTextBox.style.display = 'block';
          } else {
            guideTextBox.innerHTML = '';
            guideTextBox.style.display = 'none';
          }
        }
      }).open();
    }
  </script>
  <script type="text/javascript">

    var theGrid;
    var theGrid2;
    var viewdata1;
    var viewdata2;
    let SelectItem;
    let csrfToken = $("[name=_csrf]").val();

    document.readyState === 'complete' ? init() : window.onload = init;

    // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
    const date = new Date();
    date.setHours(date.getHours() + 9); // UTC+9ë¡œ í•œêµ­ ì‹œê°„ ì„¤ì •
    const today = date.toISOString().split('T')[0];

    // í˜„ì¬ ë…„ë„ì™€ ì›”ì„ ê°€ì ¸ì˜µë‹ˆë‹¤
    const currentYear = date.getFullYear();
    const currentMonth = (date.getMonth() + 1).toString().padStart(2, '0'); // 1ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1 ì²˜ë¦¬

    // ì´ë²ˆ ë‹¬ 1ì¼ì„ ì„¤ì •
    const firstDayOfMonth = `${currentYear}-${currentMonth}-01`;

    // input ê°’ ì„¤ì •
    document.getElementById('startDate').value = firstDayOfMonth;
    document.getElementById('endDate').value = today;
    document.getElementById('reqdate').value = today;
    document.getElementById('deldate').value = today;

    <!-- ì´ˆë°˜ í˜ì´ì§€ ì§„ì…ì‹œ ê·¸ë¦¬ë“œ ë°”ì¸ë”© ë-->
    function init() {
      fetchListData();
      fetchListData2();
      getMyInfo();
    }
    // ì£¼ë¬¸ì˜ë¢°í˜„í™© ê·¸ë¦¬ë“œ
    function fetchListData() {
      let data2 = [];
      const transformedData = []; // ë³€í™˜ëœ ë°ì´í„°ë¥¼ ì €ì¥í•  ë°°ì—´
      $.ajax({
        url: '/api/request/request/order_read',
        type: 'GET',
        data: {
          'search_startDate': $('#startDate').val(),
          'search_endDate': $('#endDate').val(),
          'search_remark': $('#searchRemark').val(),
          'search_ordflag': $('#searchOrdflag').val()
        },
        async: false,
        success: function (data) {
          data2 = data.data;
        }
      })
      // bd_detailsë¥¼ íŒŒì‹±í•˜ì—¬ ë°°ì—´ë¡œ ë³€í™˜
      // bd_detailsê°€ ìœ íš¨í•œ JSON ë¬¸ìì—´ì¼ ë•Œë§Œ íŒŒì‹±

      const seenReqnum = new Set(); // reqnumì„ ê¸°ì¤€ìœ¼ë¡œ ì¤‘ë³µì„ í™•ì¸
      data2.forEach(item => {
        item.bd_hgrb = getHgrb((item.bd_hgrb));
        item.bd_exfmtypedv = getListCgrb2(item.bd_exfmtypedv);
        item.bd_infmtypedv = getListCgrb2(item.bd_infmtypedv);
        item.bd_stframedv = getListCgrb2(item.bd_stframedv);
        item.bd_stexplydv = getListCgrb2(item.bd_stexplydv);
        item.originOrdtext = item.bd_ordtext;
        // reqnumì´ ì´ë¯¸ ë³¸ ê°’ì¸ì§€ í™•ì¸
        if (!seenReqnum.has(item.reqnum)) {
          // ì²˜ìŒ ë³´ëŠ” ê²½ìš°, ê°’ì„ ì¶”ê°€í•˜ê³  Setì— ì¶”ê°€
          transformedData.push(item);
          seenReqnum.add(item.reqnum);
        } else {
          // ì´ë¯¸ ë³¸ ê²½ìš°, íŠ¹ì • í•„ë“œë¥¼ ìˆ¨ê¸°ê¸° ìœ„í•´ ë³µì‚¬í•˜ë˜ í•´ë‹¹ í•„ë“œë¥¼ nullë¡œ ì„¤ì •
          const newItem = {
            ...item,
            ordflag: null,
            reqdate: null,
            deldate: null,
            panel_ht: null,
            panel_hw: null,
            panel_hl: null,
            panel_hh: null,
            remark: null,
            telno : null,
            perid : null,
            cltaddr : null,
            isdownload: false
          };
          transformedData.push(newItem);
        }
      });
      viewdata1 = new wijmo.collections.CollectionView(transformedData); // ë³€í™˜ëœ ë°ì´í„°ë¥¼ CollectionViewë¡œ ë³€í™˜
      const minRows = 12; // ìµœì†Œ í–‰ ìˆ˜
      const rowTemplate = {
        ordflag: null,
        reqdate: null,
        deldate: null,
        panel_ht: null,
        panel_hw: null,
        panel_hl: null,
        panel_hh: null,
        remark: null,
        downloads: null,
        bd_hgrb: null,
        bd_qty: null,
        bd_panel_t: null,
        bd_panel_w: null,
        bd_panel_l: null,
        bd_exfmtypedv: null,
        bd_infmtypedv: null,
        bd_stframedv: null,
        bd_stexplydv: null,
        bd_ordtext: null,
        telno: null,
        perid: null,
        cltaddr: null,
        reqnum: null,
        isdownload: null,
        hd_files: null,
        originOrdtext: null
      }; // í•„ìš”í•œ ë°ì´í„° êµ¬ì¡°

// ë¹ˆ í–‰ ì¶”ê°€
      while (viewdata1.sourceCollection.length < minRows) {
        viewdata1.sourceCollection.push({ ...rowTemplate });
      }

      if (!theGrid) {
        // ë°ì´í„° ê·¸ë¦¬ë“œì— ë°”ì¸ë”©
        theGrid = new wijmo.grid.FlexGrid('#theGrid', {
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          selectionMode: wijmo.grid.SelectionMode.Row,
          columns: [
            {binding: 'ordflag', header: 'ì§„í–‰êµ¬ë¶„', width: '*', minWidth: 100, align: 'center'},
            {binding: 'reqdate', header: 'ì£¼ë¬¸ì¼ì', width: '*', minWidth: 120, align: 'center'},
            {binding: 'deldate', header: 'ë‚©í’ˆí¬ë§ì¼', width: '*', minWidth: 120, align: 'center'},
            {binding: 'panel_ht', header: 'ë‘ê»˜', width: '*', minWidth: 70, align: 'right'},
            {binding: 'panel_hw', header: 'í­', width: '*', minWidth: 70, align: 'right'},
            {binding: 'panel_hl', header: 'ê¸¸ì´', width: '*', minWidth: 70, align: 'right'},
            {binding: 'panel_hh', header: 'ë†’ì´', width: '*', minWidth: 70, align: 'right'},
            {binding: 'remark', header: 'ì œëª©', width: '*', minWidth: 250, align: 'left'},
            {binding: 'downloads', header: 'ì²¨ë¶€íŒŒì¼', width: '*', minWidth: 105, align: 'center'},

            {binding: 'bd_hgrb', header: 'ì œí’ˆêµ¬ì„±', width: '*', minWidth: 100, align: 'left'},
            {binding: 'bd_qty', header: 'ìˆ˜ëŸ‰', width: '*', minWidth: 70, align: 'right'},
            {binding: 'bd_panel_t', header: 'T', width: '*', minWidth: 70, align: 'right'},
            {binding: 'bd_panel_w', header: 'W/H', width: '*', minWidth: 70, align: 'right'},
            {binding: 'bd_panel_l', header: 'L', width: '*', minWidth: 70, align: 'right'},
            {binding: 'bd_exfmtypedv', header: 'ì™¸ë¶€ë§ˆê°ì¬', width: '*', minWidth: 100, align: 'center'},
            {binding: 'bd_infmtypedv', header: 'ì™¸ë¶€ë³´ê°•ì¬', width: '*', minWidth: 100, align: 'center'},
            {binding: 'bd_stframedv', header: 'ë‚´ë¶€ë³´ê°•ì¬', width: '*', minWidth: 100, align: 'center'},
            {binding: 'bd_stexplydv', header: 'ë‚´ë¶€ë§ˆê°ì¬', width: '*', minWidth: 100, align: 'center'},
            {binding: 'bd_ordtext', header: 'ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­', width: '*', minWidth: 130, align: 'center'},
            {binding: 'telno', header: 'ì—°ë½ì²˜', width: '*', minWidth: 140, align: 'center'},
            {binding: 'perid', header: 'ë‹´ë‹¹ì', width: '*', minWidth: 100, align: 'center'},
            {binding: 'cltaddr', header: 'ìƒì„¸ì£¼ì†Œ', width: '*', minWidth: 300, align: 'left'},

            {binding: 'reqnum', visible: false},  // ìˆ¨ê¸¸ ì»¬ëŸ¼
            {binding: 'isdownload', visible: false},
            {binding: 'hd_files', visible: false},
            {binding: 'originOrdtext', visible: false},
          ],
          itemsSource: viewdata1,
          itemFormatter: function (panel, r, c, cell) {
            if (panel.cellType === wijmo.grid.CellType.Cell) {
              var item = panel.rows[r].dataItem; // í˜„ì¬ í–‰ì˜ ë°ì´í„° í•­ëª©
              if (panel.columns[c].binding === 'downloads') {
                cell.innerHTML = ''; // ì…€ ë‚´ìš© ì´ˆê¸°í™”
                if (item.isdownload) {
                  cell.innerHTML = '<a title="ë‹¤ìš´ë¡œë“œ" class="btn-filedown" onclick="downloadFile_order()">ë‹¤ìš´ë¡œë“œ</a>';
                }
              }
              if (panel.columns[c].binding === 'bd_ordtext') {
                if (item.bd_ordtext) {
                  cell.innerHTML = '<a title="ìˆ˜ì •íŒì—…" class="" onclick="showPopup2(\'popup2\')" style="color: #03428E">ìš”ì²­ì‚¬í•­ í™•ì¸</a>';
                }
              }
            }
          }
        });
        // í—¤ë”ë¥¼ ì¤‘ì•™ ì •ë ¬í•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        theGrid.formatItem.addHandler(function (s, e) {
          if (e.panel === s.columnHeaders) {
            e.cell.style.textAlign = 'center';
          }
        });
        // ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸
        theGrid.hostElement.addEventListener('dblclick', function (e) {
          // ê·¸ë¦¬ë“œì˜ ì…€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          let hitTest = theGrid.hitTest(e);
          if (hitTest.cellType === wijmo.grid.CellType.Cell) {
            // í–‰(row), í–‰ì˜ ë°ì´í„°(item) ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            let row = hitTest.row;
            let item = theGrid.rows[row].dataItem;
            if (!item.ordflag && item.reqnum) {
              let hdRow = viewdata1.items.find(data => data.reqnum === item.reqnum && data.ordflag);
              if (hdRow) {
                document.getElementById('reqdate').value = hdRow.reqdate;
                document.getElementById('deldate').value = hdRow.deldate;
                document.getElementById('telno').value = hdRow.telno;
                document.getElementById('perid').value = hdRow.perid;
                document.getElementById('postno').value = hdRow.cltzipcd;
                document.getElementById('address1').value = hdRow.cltaddr;
                document.getElementById('panel_ht').value = hdRow.panel_ht;
                document.getElementById('panel_hw').value = hdRow.panel_hw;
                document.getElementById('panel_hl').value = hdRow.panel_hl;
                document.getElementById('panel_hh').value = hdRow.panel_hh;
                document.getElementById('remark').value = hdRow.remark;
              }
            }else {
              document.getElementById('reqdate').value = item.reqdate;
              document.getElementById('deldate').value = item.deldate;
              document.getElementById('telno').value = item.telno;
              document.getElementById('perid').value = item.perid;
              document.getElementById('postno').value = item.cltzipcd;
              document.getElementById('address1').value = item.cltaddr;
              document.getElementById('panel_ht').value = item.panel_ht;
              document.getElementById('panel_hw').value = item.panel_hw;
              document.getElementById('panel_hl').value = item.panel_hl;
              document.getElementById('panel_hh').value = item.panel_hh;
              document.getElementById('remark').value = item.remark;
            }
            let fileList = Array.isArray(item.hd_files) ? item.hd_files : [];

            deletedFiles2 = [];
            uploadedFiles2 = [];

            fileList.forEach(file => {
              let newFile = {
                name: file.fileornm,
                type: file.fileextns,
                size: file.filesize,
                fileid: file.fileid,
                reqseq: item.reqseq,
                lastModified: new Date().getTime(),
              };
              uploadedFiles2.push(newFile); // íŒŒì¼ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
            });


            $('.filelist2').empty(); // íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
            updateFileCount2();
            updateFileListUI2();

            // document.getElementById('qty').value = item.bd_details.qty;
            // document.getElementById('panel_t').value = item.bd_details.panel_t;
            // document.getElementById('panel_w').value = item.bd_details.panel_w;
            // document.getElementById('panel_l').value = item.bd_details.panel_l;
            // document.getElementById('ordtext').value = item.bd_details.ordtext;
            //
            // const selectHgrb = document.getElementById('hgrb');
            // const selectExfmtypedv = document.getElementById('exfmtypedv');
            // const selectInfmtypedv = document.getElementById('infmtypedv');
            // const selectStframedv = document.getElementById('stframedv');
            // const selectStexplydv = document.getElementById('stexplydv');
            //
            // const selectedItem = item;
            //
            // setSelectedIndex(selectHgrb, selectedItem.bd_details.hgrb);
            // setSelectedIndex(selectExfmtypedv, selectedItem.bd_details.exfmtypedv);
            // setSelectedIndex(selectInfmtypedv, selectedItem.bd_details.infmtypedv);
            // setSelectedIndex(selectStframedv, selectedItem.bd_details.stframedv);
            // setSelectedIndex(selectStexplydv, selectedItem.bd_details.stexplydv);
            document.getElementById('btnSave').title = "ìˆ˜ì •";
            document.getElementById('reqnum').value = item.reqnum;
            resetBodyField();
            const tab1Link = document.getElementById('listTabLink');
            tab1Link.click();
            fetchListData2();
          }
        })
        // FlexGridì˜ ìµœëŒ€ ë†’ì´ë¥¼ ì œí•œí•˜ì—¬ ìŠ¤í¬ë¡¤ë°”ë¥¼ í™œì„±í™”
        theGrid.hostElement.style.maxHeight = '650px'; // ì•½ 12ê°œì˜ í–‰ ë†’ì´ì— ë§ê²Œ ì„¤ì •
        theGrid.hostElement.style.overflowY = 'auto';
        // ì„ íƒì´ ë³€ê²½ë  ë•Œ, í˜„ì¬ í•­ëª© ì—…ë°ì´íŠ¸
        theGrid.rowHeaders.columns.splice(0, 1);  //ë§¨ ì•ì— í—¤ë”ë¶€ë¶„ ì—†ì• ê¸°
        new FlexGridContextMenu(theGrid);
        window.downloadFileName = 'ì£¼ë¬¸ë“±ë¡ ì²¨ë¶€íŒŒì¼';
      } else {
        // ì´ë¯¸ FlexGridì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°, ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸
        theGrid.itemsSource = viewdata1;
      }
    }

    // ì£¼ë¬¸ë“±ë¡ ì„¸ë¶€ë‚´ìš© ê·¸ë¦¬ë“œ
    function fetchListData2() {
      let data2 = [];

      $.ajax({
        url: '/api/request/request/read',
        type: 'GET',
        data: {
          'reqnum': $('#reqnum').val(),
          'reqdate': $('#reqdate').val()
        },
        async: false,
        success: function (data) {
          data2 = data.data;
          data2.forEach(item =>{
            item.hgrb = getHgrb((item.hgrb));
            item.exfmtypedv = getListCgrb2(item.exfmtypedv);
            item.infmtypedv = getListCgrb2(item.infmtypedv);
            item.stframedv = getListCgrb2(item.stframedv);
            item.stexplydv = getListCgrb2(item.stexplydv);
            item.originOrdtext = item.ordtext;
          })
        }
      })

      viewdata2 = new wijmo.collections.CollectionView(data2);

      if (!theGrid2) {

        // ë°ì´í„° ê·¸ë¦¬ë“œì— ë°”ì¸ë”©
        theGrid2 = new wijmo.grid.FlexGrid('#theGrid2', {
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          selectionMode: wijmo.grid.SelectionMode.Row,
          columns: [
            {binding: 'hgrb', header: 'ì œí’ˆêµ¬ì„±', width: '*', minWidth: 100, align: 'center'},
            {binding: 'qty', header: 'ìˆ˜ëŸ‰', width: 80, align: 'right'},
            {binding: 'panel_t', header: 'T', width: 80, align: 'right'},
            {binding: 'panel_w', header: 'W/H', width: 80, align: 'right'},
            {binding: 'panel_l', header: 'L', width: 80, align: 'right'},
            {binding: 'exfmtypedv', header: 'ì™¸ë¶€ë§ˆê°ì¬', width: '*', minWidth: 100, align: 'center'},
            {binding: 'infmtypedv', header: 'ì™¸ë¶€ë³´ê°•ì¬', width: '*', minWidth: 100, align: 'center'},
            {binding: 'stframedv', header: 'ë‚´ë¶€ë³´ê°•ì¬', width: '*', minWidth: 100, align: 'center'},
            {binding: 'stexplydv', header: 'ë‚´ë¶€ë§ˆê°ì¬', width: '*', minWidth: 100, align: 'center'},
            {binding: 'ordtext', header: 'ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­', width: '*', minWidth: 100, align: 'left'},
            {binding: 'originOrdtext', visible: false},
            {binding: 'reqseq', visible: false},
            {binding: 'isnew', visible: false},
          ],
          itemsSource: viewdata2,
          itemFormatter: function (panel, r, c, cell) {
            if (panel.cellType === wijmo.grid.CellType.Cell) {
              var item = panel.rows[r].dataItem; // í˜„ì¬ í–‰ì˜ ë°ì´í„° í•­ëª©
              if (panel.columns[c].binding === 'ordtext') {
                cell.innerHTML = ''; // ì…€ ë‚´ìš© ì´ˆê¸°í™”
                if (item.ordtext) {
                  cell.innerHTML = '<a title="ìˆ˜ì •íŒì—…" class="" onclick="showPopup3(\'popup2\')" style="color: #03428E">ìš”ì²­ì‚¬í•­ í™•ì¸</a>';
                }
              }
            }
          }
        });
        // í—¤ë”ë¥¼ ì¤‘ì•™ ì •ë ¬í•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        theGrid2.formatItem.addHandler(function (s, e) {
          if (e.panel === s.columnHeaders) {
            e.cell.style.textAlign = 'center';
          }
        });
        // ì²«ì—´ì— selectBox ì¶”ê°€
        let selector = new wijmo.grid.selector.Selector(theGrid2, {
          itemChecked: (e, ctx) => {
            SelectItem = theGrid2.rows.filter(r => r.isSelected);

          }
        })
        // ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸
        theGrid2.hostElement.addEventListener('dblclick', function (e) {
          // ê·¸ë¦¬ë“œì˜ ì…€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          let hitTest = theGrid2.hitTest(e);
          if (hitTest.cellType === wijmo.grid.CellType.Cell) {
            // í–‰(row), í–‰ì˜ ë°ì´í„°(item) ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            let row = hitTest.row;
            let item = theGrid2.rows[row].dataItem;

            document.getElementById('qty').value = item.qty;
            document.getElementById('panel_t').value = item.panel_t;
            document.getElementById('panel_w').value = item.panel_w;
            document.getElementById('panel_l').value = item.panel_l;
            document.getElementById('reqseq').value = item.reqseq;
            document.getElementById('isnew').value = item.isnew;
            if (tinymce.get('ordtext')) {  // âœ… TinyMCE ì¸ìŠ¤í„´ìŠ¤ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
              tinymce.get('ordtext').setContent(item.ordtext || "");  // âœ… null ë˜ëŠ” undefined ë°©ì§€
            } else {
              console.error("ğŸš¨ TinyMCE ì—ë””í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ˆê¸°í™” ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.");
            }

            const selectHgrb = document.getElementById('hgrb');
            const selectExfmtypedv = document.getElementById('exfmtypedv');
            const selectInfmtypedv = document.getElementById('infmtypedv');
            const selectStframedv = document.getElementById('stframedv');
            const selectStexplydv = document.getElementById('stexplydv');

            const selectedItem = item;

            setSelectedIndex(selectHgrb, selectedItem.hgrb);
            setSelectedIndex(selectExfmtypedv, selectedItem.exfmtypedv);
            setSelectedIndex(selectInfmtypedv, selectedItem.infmtypedv);
            setSelectedIndex(selectStframedv, selectedItem.stframedv);
            setSelectedIndex(selectStexplydv, selectedItem.stexplydv);
          }
        })
        // FlexGridì˜ ìµœëŒ€ ë†’ì´ë¥¼ ì œí•œí•˜ì—¬ ìŠ¤í¬ë¡¤ë°”ë¥¼ í™œì„±í™”
        theGrid2.hostElement.style.maxHeight = '300px'; // ì•½ 5ê°œì˜ í–‰ ë†’ì´ì— ë§ê²Œ ì„¤ì •
        theGrid2.hostElement.style.overflowY = 'auto';
        // ì„ íƒì´ ë³€ê²½ë  ë•Œ, í˜„ì¬ í•­ëª© ì—…ë°ì´íŠ¸
        new FlexGridContextMenu(theGrid2);
        window.downloadFileName = 'ì£¼ë¬¸ë“±ë¡';
      } else {
        // ì´ë¯¸ FlexGridì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°, ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸
        theGrid2.itemsSource = viewdata2;
      }
    }
    // optionê°’ value bind
    function setSelectedIndex(selectElement, selectedValue) {
      let found = false;

      for (let i = 0; i < selectElement.options.length; i++) {
        if (selectElement.options[i].text.trim().toLowerCase() === String(selectedValue).trim().toLowerCase()) {
          selectElement.selectedIndex = i;
          found = true;
          break;
        }
      }

      // ì¼ì¹˜í•˜ëŠ” ê°’ì´ ì—†ì„ ê²½ìš°, ê¸°ë³¸ê°’ 0 ì„¤ì •
      if (!found) {
        selectElement.selectedIndex = 0;
      }
    }

    // ì£¼ë¬¸ë“±ë¡
    function saveOrder(){
      // í•„ìˆ˜ ì…ë ¥ í•„ë“œ ê²€ì‚¬
      let requiredFields = [
        {id: '#reqdate', label: 'ì£¼ë¬¸ì¼ìë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”'},
        {id: '#deldate', label: 'ë‚©í’ˆí¬ë§ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”'},
        {id: '#telno', label: 'ì—°ë½ì²˜ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”'},
        {id: '#perid', label: 'ë‹´ë‹¹ìëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”'},
        {id: '#postno', label: 'ì£¼ì†Œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”'},
        {id: '#remark', label: 'ì œëª©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”'}
      ];
      // ì„¸ë¶€í•­ëª© í–‰ ì¶”ê°€ ì—¬ë¶€ ê²€ì‚¬
      const allRowsEmpty = viewdata2.sourceCollection.every(row => !row.hgrb || row.hgrb === '');
      if (allRowsEmpty) {
        Alert.alert('', 'ì„¸ë¶€í•­ëª©ì— ì¶”ê°€ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      for (let i = 0; i < requiredFields.length; i++) {
        let field = requiredFields[i];
        let $element = $(field.id);
        let value = $element.val();

        // ìš”ì†Œê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜, ê°’ì´ ë¹ˆ ë¬¸ìì—´(ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš°)ì¸ ê²½ìš° ê²½ê³ 
        if ($element.length === 0 || value === null || value.trim() === '') {
          Alert.alert('', field.label);
          return;
        }
      }
      // title ê°’ì„ ê°€ì ¸ì˜¤ê¸°
      const title = document.getElementById('btnSave').title;

      // ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ê²°ì •í•˜ëŠ” ë³€ìˆ˜
      let alertMessage;
      // title ê°’ì— ë”°ë¼ ì•Œë¦¼ ë©”ì‹œì§€ ì„¤ì •
      if (title === "ì €ì¥") {
        alertMessage = 'ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
      } else {
        alertMessage = 'ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
      }
      Alert.confirm('', alertMessage, function () {
        // ì£¼ë¬¸ë²ˆí˜¸ ìƒì„±
        let formData = new FormData();
        // ë‹¤ë¥¸ ë°ì´í„°ë¥¼ FormDataì— ì¶”ê°€í•©ë‹ˆë‹¤.
        formData.append('reqdate', $('#reqdate').val());
        formData.append('deldate', $('#deldate').val());
        formData.append('telno', $('#telno').val());
        formData.append('perid', $('#perid').val());
        formData.append('postno', $('#postno').val());
        formData.append('address1', $('#address1').val());
        formData.append('panel_ht', $('#panel_ht').val());
        formData.append('panel_hw', $('#panel_hw').val());
        formData.append('panel_hl', $('#panel_hl').val());
        formData.append('panel_hh', $('#panel_hh').val());
        formData.append('remark', $('#remark').val());
        formData.append('reqnum', $('#reqnum').val());

        let bodyForms = [];
        // ê·¸ë¦¬ë“œ í–‰ì˜ ë°ì´í„°ë¥¼ detailForm ê°ì²´ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function extractGridData() {
          // ê·¸ë¦¬ë“œê°€ ì´ˆê¸°í™”ëœ ìƒíƒœì¸ì§€ í™•ì¸
          if (!theGrid2) {
            console.error("ì„¸ë¶€í•­ëª© ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§„ ì•ŠìŠµë‹ˆë‹¤.");
            return;
          }
          // ëª¨ë“  ê·¸ë¦¬ë“œ í–‰ ë°ì´í„°ë¥¼ ìˆœíšŒí•˜ì—¬ detailFormsì— ì¶”ê°€
          for (let i = 0; i < theGrid2.rows.length; i++) {
            // ê° í–‰ì˜ ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ìƒì„±
            let rowData = theGrid2.rows[i].dataItem;
            // rowDataê°€ nullì¸ì§€ í™•ì¸
            if (rowData && rowData.hgrb !== undefined) {
              let bodyForm = {
                hgrb: getHgrb2(rowData.hgrb),
                qty: rowData.qty,
                panel_t: rowData.panel_t,
                panel_w: rowData.panel_w,
                panel_l: rowData.panel_l,
                exfmtypedv: getListCgrb3(rowData.exfmtypedv),
                infmtypedv:getListCgrb3(rowData.infmtypedv),
                stframedv: getListCgrb3(rowData.stframedv),
                stexplydv: getListCgrb3(rowData.stexplydv),
                ordtext: rowData.ordtext,
                reqseq: rowData.reqseq
              };
              // bodyForms ë°°ì—´ì— detailForm ê°ì²´ ì¶”ê°€
              bodyForms.push(bodyForm);
            }
          }
        }
        extractGridData();
        formData.append('bodyData', JSON.stringify(bodyForms));
        // ìƒˆë¡œ ì¶”ê°€ëœ íŒŒì¼ë§Œ í¼ ë°ì´í„°ì— ì¶”ê°€
        uploadedFiles2.forEach((file, index) => {
          formData.append('filelist', file);
        });

        // ì‚­ì œëœ íŒŒì¼ ëª©ë¡ ì¶”ê°€
        deletedFiles2.forEach((file, index) => {
          formData.append('deletedFiles2', new Blob([JSON.stringify(file)], {type: 'application/json'}));
        });
        function sendAjaxRequest(url) {
          $.ajax({
            url: url,
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            headers: {
              'X-CSRF-Token': $('[name=_csrf]').val() // CSRF í† í°ì„ í—¤ë”ì— ì¶”ê°€
            },
            success: handleAjaxResponse,
            error: function () {
              Alert.alert('', 'ì—ëŸ¬ê°€ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.');
            }
          });
        }

        function handleAjaxResponse(response) {
          if (response.success) {
            Alert.alert('', response.message, function () {
              fetchListData();
              resetFormFields();
            });
          } else {
            Alert.alert('', 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        }
        sendAjaxRequest('/api/request/request/save');
      })
    }
    // DOMì´ ì™„ì „íˆ ì¤€ë¹„ëœ í›„ì— íŠ¹ì • ì½”ë“œ ì‹¤í–‰
    $(document).ready(function (e) {
      const selectElementId = 'hgrb';
      getListHgrb(selectElementId);
      // const selectElementId2 = ['exfmtypedv','infmtypedv','stframedv','stexplydv'];
      // for (const items of selectElementId2){
      //   getListCgrb(items);
      // }
    })
    // ì œí’ˆêµ¬ì„± ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ëŠ” function
    function getListHgrb(selectElementId){
      fetch(`/api/request/request/getListHgrb`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          const selectElement = document.getElementById(selectElementId);
          // "ì „ì²´" ì˜µì…˜ì´ ìˆëŠ”ì§€ í™•ì¸
          const allOption = selectElement.querySelector('option[value=""]:not([disabled]):not([hidden])');
          // "ì„ íƒ" ì˜µì…˜ì´ ìˆëŠ”ì§€ í™•ì¸
          const defaultOption = selectElement.querySelector('option[value=""][disabled][hidden]');
          // ê¸°ì¡´ ì˜µì…˜ ì œê±° (íŠ¹ì • ì˜µì…˜ ì œì™¸)
          selectElement.innerHTML = ''; // ëª¨ë“  ì˜µì…˜ ì œê±°
          // "ì „ì²´" ì˜µì…˜ì´ ìˆìœ¼ë©´ ë‹¤ì‹œ ì¶”ê°€ (ì„ íƒ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •)
          if (allOption) {
            allOption.selected = true; // ì „ì²´ë¥¼ ê¸°ë³¸ ì„ íƒìœ¼ë¡œ ìœ ì§€
            selectElement.appendChild(allOption);
          }
          // "ì„ íƒ" ì˜µì…˜ì´ ìˆìœ¼ë©´ ë‹¤ì‹œ ì¶”ê°€ (ì„ íƒ ë¶ˆê°€ëŠ¥í•˜ê²Œ ì„¤ì •)
          if (defaultOption) {
            selectElement.appendChild(defaultOption);
          }
          data.data.forEach(item => {
            const option = document.createElement('option');
            option.value = item.hgrb;
            option.textContent = item.hgrbnm; // item.valueë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì˜ "Value" í•„ë“œë¡œ ë³€ê²½
            selectElement.appendChild(option);
          });
        })
        .catch(error => {
          console.error('Error fetching options:', error);
        });
    }
    // `getListCgrb` í•¨ìˆ˜ì—ì„œ `cgrb` ì½”ë“œì— ë”°ë¼ ì´ë¦„ì„ ë°˜í™˜
    function getListCgrb2(cgrb) {
      return cgrbMapping[cgrb] || " "; // ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜
    }
    // ë“±ë¡ì‹œ ì¬ ë§¤í•‘
    function getListCgrb3(cgrb) {
      return cgrbMapping2[cgrb] || " "; // ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜
    }
    // ë³´ê°•ì¬,ë§ˆê°ì¬ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ëŠ” function
    function getListCgrb(selectElementId){
      fetch(`/api/request/request/getListCgrb`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          const selectElement = document.getElementById(selectElementId);
          // "ì „ì²´" ì˜µì…˜ì´ ìˆëŠ”ì§€ í™•ì¸
          const allOption = selectElement.querySelector('option[value=""]:not([disabled]):not([hidden])');
          // "ì„ íƒ" ì˜µì…˜ì´ ìˆëŠ”ì§€ í™•ì¸
          const defaultOption = selectElement.querySelector('option[value=""][disabled]:not([hidden])');
          // ê¸°ì¡´ ì˜µì…˜ ì œê±° (íŠ¹ì • ì˜µì…˜ ì œì™¸)
          selectElement.innerHTML = ''; // ëª¨ë“  ì˜µì…˜ ì œê±°
          // "ì „ì²´" ì˜µì…˜ì´ ìˆìœ¼ë©´ ë‹¤ì‹œ ì¶”ê°€ (ì„ íƒ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •)
          if (allOption) {
            allOption.selected = true; // ì „ì²´ë¥¼ ê¸°ë³¸ ì„ íƒìœ¼ë¡œ ìœ ì§€
            selectElement.appendChild(allOption);
          }
          // "ì„ íƒ" ì˜µì…˜ì´ ìˆìœ¼ë©´ ë‹¤ì‹œ ì¶”ê°€
          if (defaultOption) {
            selectElement.appendChild(defaultOption);
          }
          data.data.forEach(item => {
            const option = document.createElement('option');
            option.value = item.cgrb;
            option.textContent = item.cgrbnm; // item.valueë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì˜ "Value" í•„ë“œë¡œ ë³€ê²½
            selectElement.appendChild(option);
          });
        })
        .catch(error => {
          console.error('Error fetching options:', error);
        });
    }
    // ì…€ë ‰íŠ¸ê°’ì— ë”°ë¼ id íˆë“ ìœ¼ë¡œ ë„˜ê¸°ê¸°
    function updateSelect(selectId, hiddenInputId) {
      var selectElement = document.getElementById(selectId);
      var selectedOptionText = selectElement.options[selectElement.selectedIndex].text;
      document.getElementById(hiddenInputId).value = selectedOptionText;
    }
    // ì„¸ë¶€ì‚¬í•­ ì¶”ê°€
    function addBody() {
      const isnewValue = Number(document.getElementById('isnew').value);

      const newRowData = {
        hgrb: getHgrb(document.getElementById("hgrb").value),
        qty: Number(document.getElementById("qty").value),
        panel_t: document.getElementById("panel_t").value,
        panel_w: document.getElementById("panel_w").value,
        panel_l: document.getElementById("panel_l").value,
        exfmtypedv: getListCgrb2(document.getElementById("exfmtypedv").value),
        infmtypedv: getListCgrb2(document.getElementById("infmtypedv").value),
        stframedv: getListCgrb2(document.getElementById("stframedv").value),
        stexplydv: getListCgrb2(document.getElementById("stexplydv").value),
        reqseq: document.getElementById("reqseq").value,
        ordtext: tinymce.get('ordtext').getContent(),
        originOrdtext: tinymce.get('ordtext').getContent(),
        isnew: isnewValue // isnewValueë¥¼ ì§ì ‘ ì‚¬ìš©
      };

      const sourceCollection = viewdata2.sourceCollection;
      let isUpdated = false;  // ì—…ë°ì´íŠ¸ ì—¬ë¶€ í”Œë˜ê·¸

      for (let i = 0; i < sourceCollection.length; i++) {

        // reqseqê°€ ì—†ì„ ê²½ìš° isnewë¡œ ë¹„êµ
        if (newRowData.reqseq === sourceCollection[i].reqseq && newRowData.reqseq !== "") {
          sourceCollection[i] = { ...sourceCollection[i], ...newRowData };  // Update existing row
          isUpdated = true;  // ì—…ë°ì´íŠ¸ í”Œë˜ê·¸ ì„¤ì •
          break;  // ì—…ë°ì´íŠ¸ í›„ ë£¨í”„ ì¢…ë£Œ
        } else if (Number(newRowData.isnew) === Number(sourceCollection[i].isnew) && newRowData.isnew !== "") {
          sourceCollection[i] = { ...sourceCollection[i], ...newRowData };  // Update existing row based on isnew
          isUpdated = true;  // ì—…ë°ì´íŠ¸ í”Œë˜ê·¸ ì„¤ì •
          break;  // ì—…ë°ì´íŠ¸ í›„ ë£¨í”„ ì¢…ë£Œ
        }
      }
      // ì—…ë°ì´íŠ¸ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šì€ ê²½ìš° ìƒˆë¡œìš´ í–‰ ì¶”ê°€
      if (!isUpdated) {
        const existingIsNewValues = sourceCollection.map(row => Number(row.isnew)).filter(value => !isNaN(value));
        let newIsNewValue = 1; // ê¸°ë³¸ê°’

        // ê¸°ì¡´ isnew ê°’ ì¤‘ ê°€ì¥ í° ê°’ì„ ì°¾ì•„ì„œ 1ì„ ë”í•¨
        if (existingIsNewValues.length > 0) {
          newIsNewValue = Math.max(...existingIsNewValues) + 1;
        }
        newRowData.isnew = newIsNewValue; // ìƒˆë¡œìš´ isnew ê°’ì„ ì„¤ì •
        viewdata2.addNew(newRowData);  // Add new row
      }
      viewdata2.sourceCollection = [...sourceCollection]; // ì°¸ì¡° ê°±ì‹ 
      viewdata2.commitEdit(); // ë³€ê²½ ì‚¬í•­ ì»¤ë°‹
      viewdata2.refresh(); // ë°ì´í„° ì†ŒìŠ¤ ê°±ì‹ 
      theGrid2.itemsSource = [...viewdata2.sourceCollection]; // ê·¸ë¦¬ë“œ ë°ì´í„° ì¬ì„¤ì •
      theGrid2.refresh(); // UI ê°±ì‹ 
      resetBodyField();  // Reset input fields
    }
    // í–‰ ë³µì‚¬
    function copyLastRow() {
      if (!theGrid2 || !theGrid2.itemsSource) {
        alert("ê·¸ë¦¬ë“œê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        return;
      }

      // ë°ì´í„° ì†ŒìŠ¤ í™•ì¸
      const sourceCollection = theGrid2.itemsSource || [];
      if (sourceCollection.length === 0) {
        alert("ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      // ë§ˆì§€ë§‰ í–‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const lastRowData = sourceCollection[sourceCollection.length - 1];

      // ìƒˆë¡œìš´ ë°ì´í„° ìƒì„±
      const newRowData = { ...lastRowData };
      newRowData.reqseq = ""; // ê³ ìœ ê°’ ì´ˆê¸°í™”
      newRowData.isnew = (Math.max(...sourceCollection.map(row => Number(row.isnew) || 0)) + 1); // ìƒˆë¡œìš´ isnew ê°’

      // ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€
      sourceCollection.push(newRowData);

      // ë°ì´í„° ê°±ì‹  ë° UI ì—…ë°ì´íŠ¸
      viewdata2.sourceCollection = [...sourceCollection]; // ì°¸ì¡° ê°±ì‹ 
      viewdata2.commitEdit(); // ë³€ê²½ ì‚¬í•­ ì»¤ë°‹
      viewdata2.refresh(); // ë°ì´í„° ì†ŒìŠ¤ ê°±ì‹ 
      theGrid2.itemsSource = [...viewdata2.sourceCollection]; // ê·¸ë¦¬ë“œ ë°ì´í„° ì¬ì„¤ì •
      theGrid2.refresh(); // UI ê°±ì‹ 

      Alert.alert('',"í–‰ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }


    // í–‰(ì„¸ë¶€ì‚¬í•­) ì‚­ì œ(ë§ˆì§€ë§‰ ì„¸ë¶€ì‚¬í•­ ì‚­ì œì‹œ í—¤ë“œì •ë³´ë„ ê°™ì´ ì‚­ì œ)
    function deleteBody(){
      if(SelectItem === undefined || SelectItem.length === 0){
        Alert.alert('', 'ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
        return;
      }
      Alert.confirm('', 'ì„ íƒëœ í–‰ ë‚´ìš©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function () {
        const deletePromises = []; // ë¹„ë™ê¸° ìš”ì²­ì„ ì €ì¥í•  ë°°ì—´
        SelectItem.forEach(selectedRow => {
          const selectedData = selectedRow.dataItem;
          const index = viewdata2.sourceCollection.indexOf(selectedData);
          if (index > -1) {
            const itemToRemove = viewdata2.sourceCollection[index]; // ì‚­ì œí•  í•­ëª© ê°€ì ¸ì˜¤ê¸°
            viewdata2.remove(itemToRemove); // CollectionViewì—ì„œ í•­ëª© ì‚­ì œ
            if(selectedData.reqseq !== ""){
              let deleteNum = {
                reqseq: selectedData.reqseq,
                reqnum: document.getElementById('reqnum').value
              };
              let fnSuccess = function (res) {
                isProcessing = false;
                if (res.success) {
                  fetchListData();
                }
              };
              const promise = AjaxUtil.postAsyncData('/api/request/request/bodyDelete', deleteNum, fnSuccess);
              deletePromises.push(promise);
            }
          }
        });
        viewdata2.commitEdit(); // ë³€ê²½ ì‚¬í•­ ì €ì¥
        Promise.all(deletePromises).then(() => {
          viewdata2.commitEdit(); // ë³€ê²½ ì‚¬í•­ ì»¤ë°‹
          viewdata2.refresh(); // ë°ì´í„° ì†ŒìŠ¤ ê°±ì‹ 
          theGrid2.itemsSource = [...viewdata2.sourceCollection]; // ê·¸ë¦¬ë“œ ë°ì´í„° ì¬ì„¤ì •
          theGrid2.refresh(); // UI ê°±ì‹ 
          // ëª¨ë“  í–‰ì´ ë¹ˆì§€ ê²€ì‚¬í•˜ì—¬ í—¤ë” ì‚­ì œ ë©”ì„œë“œ í˜¸ì¶œ
          const allRowsEmpty = viewdata2.sourceCollection.every(row => !row.hgrb || row.hgrb === '');
          if (allRowsEmpty) {
            deletehead();
            fetchListData2();
          }
        }).catch(error => {
          console.error('Error during deletion:', error);
          Alert.alert('', 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
      })
    }


    // í—¤ë“œì •ë³´ ì‚­ì œ(ì„¸ë¶€ì‚¬í•­ ì¡´ì¬ì‹œ ì•ˆë‚´ alertê¸°ëŠ¥)
    $(document).ready(function () {
      $('#deleteButton').off('click').on('click', deletehead);
    });

    let isProcessing = false;

    function deletehead() {
      if (isProcessing) return;

      const reqnum = $('#reqnum').val();
      if (!reqnum) {
        Alert.alert('', 'ì‚­ì œí•  í•­ëª©ì„\nì§„í–‰í˜„í™©ì—ì„œ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      Alert.confirm('', 'ì£¼ë¬¸ ë“±ë¡ì •ë³´ë¥¼\nì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function () {
        isProcessing = true;

        let data = {
          'reqnum': reqnum,
          '_csrf': csrfToken
        };

        let fnSuccess = function (res) {
          isProcessing = false;
          if (res.success) {
            Alert.alert('', 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            fetchListData();
            resetFormFields();
          }
        };

        AjaxUtil.postAsyncData('/api/request/request/delete', data, fnSuccess);
      });
    }

    // í•„ë“œê°’ ì´ˆê¸°í™”
    function resetFormFields() {
      const fieldsToReset = [
        'panel_ht',
        'panel_hw', 'panel_hl', 'panel_hh', 'remark', 'hgrb',
        'qty', 'panel_t', 'panel_w', 'panel_l',
        'exfmtypedv', 'infmtypedv', 'stframedv', 'stexplydv', 'reqnum', 'reqseq'
      ];

      fieldsToReset.forEach(fieldId => {
        document.getElementById(fieldId).value = '';

      });
      tinymce.get('ordtext').setContent("");
      document.getElementById('reqdate').value = today;
      document.getElementById('deldate').value = today;
      $('.filelist2').empty(); // íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
      uploadedFiles2 = []; // ì—…ë¡œë“œëœ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
      deletedFiles2 = [];
      // ì´ˆê¸°í™”ëœ íŒŒì¼ ê°œìˆ˜ ì—…ë°ì´íŠ¸
      updateFileCount2();
      resetFileInput($('.fileInput2'));
      $('.text-count').text('0/100'); // ê¸€ì ìˆ˜ 0ìœ¼ë¡œ ì´ˆê¸°í™”
      // íŠ¹ì • í•„ë“œì— ëŒ€í•œ btn-clear ìˆ¨ê¹€ ì²˜ë¦¬
      $('#doctitle').each(function () {
        $(this).siblings('.btn-clear').hide();
      });

      let data2 = [];
      // ê¸°ì¡´ CollectionViewë¥¼ ì´ˆê¸°í™”í•˜ê¸° ìœ„í•´ sourceCollectionì„ ë¹ˆ ë°°ì—´ë¡œ ì„¤ì • í›„ ìƒˆ ë°ì´í„° í• ë‹¹
      if (viewdata2) {
        viewdata2.sourceCollection = data2;
        viewdata2 = new wijmo.collections.CollectionView(data2);
        theGrid2.itemsSource = viewdata2;
        viewdata2.refresh();
      } else {
        viewdata2 = new wijmo.collections.CollectionView(data2);
      }

      // ê·¸ë¦¬ë“œë„ ê°±ì‹ 
      theGrid2.itemsSource = viewdata2;
      theGrid2.refresh();

      document.getElementById('btnSave').title = "ì €ì¥";
    }
    // ì„¸ë¶€ì‚¬í•­ ì œí’ˆêµ¬ì„± onchange ë©”ì„œë“œ
    function changeHgrb() {
      const reqseqElement = document.getElementById("reqseq");
      if (reqseqElement && reqseqElement.value !== "") { // reqseqê°€ ì¡´ì¬í•˜ê³  ê°’ì´ ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´
        Alert.confirm('', 'ìƒˆë¡œ ì„¸ë¶€ì‚¬í•­ì„ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\'ì·¨ì†Œ\'ì„ íƒì‹œ ì„ íƒëœ êµ¬ì„±ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.', function () {
          resetBodyField();
        });
      }
    }
    // body í•„ë“œê°’ ì´ˆê¸°í™”
    function resetBodyField() {
      const fieldsToReset = [
        'qty', 'panel_t', 'panel_w', 'panel_l', 'reqseq',
        'exfmtypedv', 'infmtypedv', 'stframedv', 'stexplydv', 'isnew'
      ];
      fieldsToReset.forEach(fieldId => {
        document.getElementById(fieldId).value = '';
      });
      tinymce.get('ordtext').setContent("");
    }
    // íŒŒì¼ ê°œìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateFileCount() {
      const fileCount = uploadedFiles2.length;
      $('.upload-filelist2 .title h5').text(`Files (${fileCount})`);
      $('.btn-file span').text(`(${fileCount})`);
    }

    // ë‹¤ìš´ë¡œë“œ
    function downloadFile_order() {
      let selectedItems = theGrid.selectedItems; // ì„ íƒëœ í•­ëª© ê°€ì ¸ì˜¤ê¸°
      let downloadList = [];

      // ì„ íƒëœ í•­ëª©ì—ì„œ ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ ëª©ë¡ ìƒì„±
      selectedItems.forEach(function (item) {
        downloadList.push({
          reqnum: item.reqnum
        });
      });

      // ë‹¤ìš´ë¡œë“œ URL ì§€ì •
      let downloadUrl = '/api/request/request/downloader';

      // Jung.jsì—ì„œ ì •ì˜í•œ downloadFiles í•¨ìˆ˜ í˜¸ì¶œ
      downloadFiles(downloadList, downloadUrl);
    }
    // ë‚´ì •ë³´ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
    function getMyInfo() {
      $.ajax({
        url: '/api/request/request/getUserInfo', // ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ URL
        type: 'GET',
        success: function(data) {
          document.getElementById("telno").value = data.data.hptelnum;
          document.getElementById("perid").value = data.data.prenm;
          document.getElementById("postno").value = data.data.zipcd;
          document.getElementById("address1").value = data.data.cltadres.replace(/\s*\|/g, '').trim();
        },
        error: function(error) {
          console.log('ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', error);
        }
      });
    }
    function showPopup2(documnetId) {
      let selectedItems = theGrid.selectedItems;
      // í•´ë‹¹ IDì˜ íŒì—… ìš”ì†Œë¥¼ ì°¾ìŒ
      const popup = document.getElementById(documnetId);

      if (popup) {
        // íŒì—…ì„ í¬í•¨í•œ ëª¨ë‹¬ì„ í‘œì‹œ
        const modal = popup.closest('.modal');
        if (modal) {
          modal.style.display = 'block';
        }

        // TinyMCE ì—ë””í„°ì— ordtext ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì—¬ ë„£ê¸°
        const ordtext = selectedItems[0].originOrdtext;

        // TinyMCE ì—ë””í„°ì— HTMLë¡œ content ì„¤ì •
        tinymce.get('ordtext').setContent(ordtext);  // 'ordtext'ëŠ” TinyMCEê°€ ì ìš©ëœ ìš”ì†Œì˜ id

        // íŒì—… ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        const button = popup.querySelector('.popup-button');
        if (button) {
          button.style.display = 'none'; // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        }
        const closebutton = popup.querySelector('.btn-popup-close');
        if (closebutton) {
          closebutton.onclick = function() {
            closePopup2('popup2'); // closePopup2ë¡œ í˜¸ì¶œ ë©”ì„œë“œ ë³€ê²½
          };
        }

        // íŒì—…ì„ í‘œì‹œ
        popup.style.display = 'block';

        // ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ í´ë˜ìŠ¤ ì¶”ê°€
        requestAnimationFrame(() => {
          popup.classList.add('show');
          if (modal) {
            modal.classList.add('show');
          }
        });
      }
    }
    function showPopup3(documnetId) {
      let selectedItems = theGrid2.selectedItems;
      // í•´ë‹¹ IDì˜ íŒì—… ìš”ì†Œë¥¼ ì°¾ìŒ
      const popup = document.getElementById(documnetId);

      if (popup) {
        // íŒì—…ì„ í¬í•¨í•œ ëª¨ë‹¬ì„ í‘œì‹œ
        const modal = popup.closest('.modal');
        if (modal) {
          modal.style.display = 'block';
        }

        // TinyMCE ì—ë””í„°ì— ordtext ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì—¬ ë„£ê¸°
        const ordtext = selectedItems[0].originOrdtext;

        // TinyMCE ì—ë””í„°ì— HTMLë¡œ content ì„¤ì •
        tinymce.get('ordtext').setContent(ordtext);  // 'ordtext'ëŠ” TinyMCEê°€ ì ìš©ëœ ìš”ì†Œì˜ id

        // íŒì—… ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        const button = popup.querySelector('.popup-button');
        if (button) {
          button.style.display = 'none'; // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        }
        const closebutton = popup.querySelector('.btn-popup-close');
        if (closebutton) {
          closebutton.onclick = function() {
            closePopup2('popup2'); // closePopup2ë¡œ í˜¸ì¶œ ë©”ì„œë“œ ë³€ê²½
          };
        }
        // íŒì—…ì„ í‘œì‹œ
        popup.style.display = 'block';

        // ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ í´ë˜ìŠ¤ ì¶”ê°€
        requestAnimationFrame(() => {
          popup.classList.add('show');
          if (modal) {
            modal.classList.add('show');
          }
        });
      }
    }


    function getHgrb(hgrb) {
      switch (hgrb) {
        case 'A0': return "ì§€ë¶•";
        case 'AA': return "ì§€ë¶•1";
        case 'AB': return "ì§€ë¶•2";
        case 'AC': return "ì§€ë¶•3";
        case 'AD': return "ì§€ë¶•4";
        case 'AE': return "ì§€ë¶•5";
        case 'AF': return "ì§€ë¶•6";
        case 'B0': return "ë°”ë‹¥";
        case 'BA': return "ë°”ë‹¥1";
        case 'BB': return "ë°”ë‹¥2";
        case 'BC': return "ë°”ë‹¥3";
        case 'BD': return "ë°”ë‹¥4";
        case 'BE': return "ë°”ë‹¥5";
        case 'BF': return "ë°”ë‹¥6";
        case 'C0': return "ì˜†ì¥";
        case 'C1': return "ì˜†ì¥1";
        case 'C2': return "ì˜†ì¥2";
        case 'C3': return "ì˜†ì¥3";
        case 'C4': return "ì˜†ì¥4";
        case 'C5': return "ì˜†ì¥5";
        case 'C6': return "ì˜†ì¥6";
        case 'CA': return "ìš´ì „ì„";
        case 'CB': return "ìš´ì „ì„1";
        case 'CC': return "ìš´ì „ì„2";
        case 'CD': return "ìš´ì „ì„3";
        case 'CE': return "ìš´ì „ì„4";
        case 'CF': return "ìš´ì „ì„5";
        case 'CG': return "ìš´ì „ì„6";
        case 'CN': return "ì¡°ìˆ˜ì„";
        case 'CO': return "ì¡°ìˆ˜ì„1";
        case 'CP': return "ì¡°ìˆ˜ì„2";
        case 'CQ': return "ì¡°ìˆ˜ì„3";
        case 'CR': return "ì¡°ìˆ˜ì„4";
        case 'CS': return "ì¡°ìˆ˜ì„5";
        case 'CT': return "ì¡°ìˆ˜ì„6";
        case 'D0': return "ì•ì¥";
        case 'DA': return "ì•ì¥1";
        case 'DB': return "ì•ì¥2";
        case 'DC': return "ì•ì¥3";
        case 'DD': return "ì•ì¥4";
        case 'DE': return "ì•ì¥5";
        case 'DF': return "ì•ì¥6";
        case 'E0': return "ë’·ì¥";
        case 'EA': return "ë’·ì¥1";
        case 'EB': return "ë’·ì¥2";
        case 'EC': return "ë’·ì¥3";
        case 'ED': return "ë’·ì¥4";
        case 'EE': return "ë’·ì¥5";
        case 'EF': return "ë’·ì¥6";
        case 'F0': return "ì¹¸ë§‰ì´";
        case 'FA': return "ì¹¸ë§‰ì´1";
        case 'FB': return "ì¹¸ë§‰ì´2";
        case 'FC': return "ì¹¸ë§‰ì´3";
        case 'FD': return "ì¹¸ë§‰ì´4";
        case 'FE': return "ì¹¸ë§‰ì´5";
        case 'FF': return "ì¹¸ë§‰ì´6";
        case 'G0': return "ë„ì–´";
        case 'GA': return "ë„ì–´1";
        case 'GB': return "ë„ì–´2";
        case 'GC': return "ë„ì–´3";
        case 'GD': return "ë„ì–´4";
        case 'GE': return "ë„ì–´5";
        case 'GF': return "ë„ì–´6";
        case 'H0': return "ë¯¸ë‹«ì´";
        case 'HA': return "ë¯¸ë‹«ì´1";
        case 'HB': return "ë¯¸ë‹«ì´2";
        case 'HC': return "ë¯¸ë‹«ì´3";
        case 'HD': return "ë¯¸ë‹«ì´4";
        case 'HE': return "ë¯¸ë‹«ì´5";
        case 'HF': return "ë¯¸ë‹«ì´6";
        case 'I0': return "ë²™ì»¤";
        case 'IA': return "ë²™ì»¤1";
        case 'IB': return "ë²™ì»¤2";
        case 'IC': return "ë²™ì»¤3";
        case 'ID': return "ë²™ì»¤4";
        case 'IE': return "ë²™ì»¤5";
        case 'IF': return "ë²™ì»¤6";
        case 'Z0': return "ê¸°íƒ€";
        case 'Z1': return "ê¸°íƒ€1";
        case 'Z2': return "ê¸°íƒ€2";
        case 'Z3': return "ê¸°íƒ€3";
        case 'Z4': return "ê¸°íƒ€4";
        case 'Z5': return "ê¸°íƒ€5";
        case 'Z6': return "ê¸°íƒ€6";
        default: return "ì•Œ ìˆ˜ ì—†ìŒ"; // ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš° ê¸°ë³¸ê°’
      }
    }

    //`cgrb` ì½”ë“œë³„ë¡œ ì´ë¦„ë§Œ ë§¤í•‘í•œ ê°ì²´
    const cgrbMapping = {
      "MAA": "AL",
      "MAB": "GI",
      "MAC": "GRP",
      "MAD": "GFGW",
      "MAE": "GFGW(B)",
      "MAF": "H-GRO",
      "MAG": "Anti-Bac",
      "MAH": "Anti-Slip",
      "MAI": "SUS",
      "MAZ": "ê¸°íƒ€",
      "MBA": "ê³¨ë“œí¼",
      "MCA": "í•©íŒ",
      "MCB": "ì½”ì–´ë§¤íŠ¸",
      "MDA": "ì£¼ì œ",
      "MDB": "ê²½í™”ì œ",
      "MAK": "Super Plus",
      "MCF": "WPC",
      "MBB": "PUë³´ë“œ",
      "MAJ": "GI(B)",
      "MAS": "Super Lite",
      "MCG": "í—ˆë‹ˆì»´",
      "MCC": "ì•„ë§ˆì…€",
      "MCD": "LTP",
      "MCE": "ê¸°íƒ€",
      "MBI": "ì•„ì´ì†Œí•‘í¬",
      "MAM": "CFRT",
      "MAL": "WR-Impact",
      "ZZ01": "ìƒ·ì‹œ",
      "ZZ02": "ìºìŠ¤íŒ…",
      "ZZ03": "ì•µê¸€",
      "ZZ04": "ì›ìì¬",
      "ZZ05": "CKD",
      "ZZ06": "ê¸°íƒ€",
      "ZZ07": "ì½”ì¼"
    };

    function getHgrb2(hgrb) {
      switch (hgrb) {
        case 'ì§€ë¶•': return "A0";
        case 'ì§€ë¶•1': return "AA";
        case 'ì§€ë¶•2': return "AB";
        case 'ì§€ë¶•3': return "AC";
        case 'ì§€ë¶•4': return "AD";
        case 'ì§€ë¶•5': return "AE";
        case 'ì§€ë¶•6': return "AF";
        case 'ë°”ë‹¥': return "B0";
        case 'ë°”ë‹¥1': return "BA";
        case 'ë°”ë‹¥2': return "BB";
        case 'ë°”ë‹¥3': return "BC";
        case 'ë°”ë‹¥4': return "BD";
        case 'ë°”ë‹¥5': return "BE";
        case 'ë°”ë‹¥6': return "BF";
        case 'ì˜†ì¥': return "C0";
        case 'ì˜†ì¥1': return "C1";
        case 'ì˜†ì¥2': return "C2";
        case 'ì˜†ì¥3': return "C3";
        case 'ì˜†ì¥4': return "C4";
        case 'ì˜†ì¥5': return "C5";
        case 'ì˜†ì¥6': return "C6";
        case 'ìš´ì „ì„': return "CA";
        case 'ìš´ì „ì„1': return "CB";
        case 'ìš´ì „ì„2': return "CC";
        case 'ìš´ì „ì„3': return "CD";
        case 'ìš´ì „ì„4': return "CE";
        case 'ìš´ì „ì„5': return "CF";
        case 'ìš´ì „ì„6': return "CG";
        case 'ì¡°ìˆ˜ì„': return "CN";
        case 'ì¡°ìˆ˜ì„1': return "CO";
        case 'ì¡°ìˆ˜ì„2': return "CP";
        case 'ì¡°ìˆ˜ì„3': return "CQ";
        case 'ì¡°ìˆ˜ì„4': return "CR";
        case 'ì¡°ìˆ˜ì„5': return "CS";
        case 'ì¡°ìˆ˜ì„6': return "CT";
        case 'ì•ì¥': return "D0";
        case 'ì•ì¥1': return "DA";
        case 'ì•ì¥2': return "DB";
        case 'ì•ì¥3': return "DC";
        case 'ì•ì¥4': return "DD";
        case 'ì•ì¥5': return "DE";
        case 'ì•ì¥6': return "DF";
        case 'ë’·ì¥': return "E0";
        case 'ë’·ì¥1': return "EA";
        case 'ë’·ì¥2': return "EB";
        case 'ë’·ì¥3': return "EC";
        case 'ë’·ì¥4': return "ED";
        case 'ë’·ì¥5': return "EE";
        case 'ë’·ì¥6': return "EF";
        case 'ì¹¸ë§‰ì´': return "F0";
        case 'ì¹¸ë§‰ì´1': return "FA";
        case 'ì¹¸ë§‰ì´2': return "FB";
        case 'ì¹¸ë§‰ì´3': return "FC";
        case 'ì¹¸ë§‰ì´4': return "FD";
        case 'ì¹¸ë§‰ì´5': return "FE";
        case 'ì¹¸ë§‰ì´6': return "FF";
        case 'ë„ì–´': return "G0";
        case 'ë„ì–´1': return "GA";
        case 'ë„ì–´2': return "GB";
        case 'ë„ì–´3': return "GC";
        case 'ë„ì–´4': return "GD";
        case 'ë„ì–´5': return "GE";
        case 'ë„ì–´6': return "GF";
        case 'ë¯¸ë‹«ì´': return "H0";
        case 'ë¯¸ë‹«ì´1': return "HA";
        case 'ë¯¸ë‹«ì´2': return "HB";
        case 'ë¯¸ë‹«ì´3': return "HC";
        case 'ë¯¸ë‹«ì´4': return "HD";
        case 'ë¯¸ë‹«ì´5': return "HE";
        case 'ë¯¸ë‹«ì´6': return "HF";
        case 'ë²™ì»¤': return "I0";
        case 'ë²™ì»¤1': return "IA";
        case 'ë²™ì»¤2': return "IB";
        case 'ë²™ì»¤3': return "IC";
        case 'ë²™ì»¤4': return "ID";
        case 'ë²™ì»¤5': return "IE";
        case 'ë²™ì»¤6': return "IF";
        case 'ê¸°íƒ€': return "Z0";
        case 'ê¸°íƒ€1': return "Z1";
        case 'ê¸°íƒ€2': return "Z2";
        case 'ê¸°íƒ€3': return "Z3";
        case 'ê¸°íƒ€4': return "Z4";
        case 'ê¸°íƒ€5': return "Z5";
        case 'ê¸°íƒ€6': return "Z6";
        default: return "ì•Œ ìˆ˜ ì—†ìŒ"; // ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš° ê¸°ë³¸ê°’
      }
    }

    //`cgrb` ì½”ë“œë³„ë¡œ ì´ë¦„ë§Œ ë§¤í•‘í•œ ê°ì²´
    const cgrbMapping2 = {
      "AL": "MAA",
      "GI": "MAB",
      "GRP": "MAC",
      "GFGW": "MAD",
      "GFGW(B)": "MAE",
      "H-GRO": "MAF",
      "Anti-Bac": "MAG",
      "Anti-Slip": "MAH",
      "SUS": "MAI",
      "ê¸°íƒ€": "MAZ",
      "ê³¨ë“œí¼": "MBA",
      "í•©íŒ": "MCA",
      "ì½”ì–´ë§¤íŠ¸": "MCB",
      "ì£¼ì œ": "MDA",
      "ê²½í™”ì œ": "MDB",
      "Super Plus": "MAK",
      "WPC": "MCF",
      "PUë³´ë“œ": "MBB",
      "GI(B)": "MAJ",
      "Super Lite": "MAS",
      "í—ˆë‹ˆì»´": "MCG",
      "ì•„ë§ˆì…€": "MCC",
      "LTP": "MCD",
      "ê¸°íƒ€": "MCE",
      "ì•„ì´ì†Œí•‘í¬": "MBI",
      "CFRT": "MAM",
      "WR-Impact": "MAL",
      "ìƒ·ì‹œ": "ZZ01",
      "ìºìŠ¤íŒ…": "ZZ02",
      "ì•µê¸€": "ZZ03",
      "ì›ìì¬": "ZZ04",
      "CKD": "ZZ05",
      "ê¸°íƒ€": "ZZ06",
      "ì½”ì¼": "ZZ07"
    };

    function closePopup2(documentId) {
      // í•´ë‹¹ IDì˜ íŒì—… ìš”ì†Œë¥¼ ì°¾ìŒ
      const popup = document.getElementById(documentId);

      if (popup) {
        // íŒì—…ì„ í¬í•¨í•œ ëª¨ë‹¬ì„ ìˆ¨ê¹€
        const modal = popup.closest('.modal');
        if (modal) {
          modal.style.display = 'none';
          modal.classList.remove('show'); // ì• ë‹ˆë©”ì´ì…˜ ì œê±°
        }

        // íŒì—… ìì²´ ìˆ¨ê¹€
        popup.style.display = 'none';
        popup.classList.remove('show'); // ì• ë‹ˆë©”ì´ì…˜ ì œê±°

        // íŒì—… ë²„íŠ¼ ë³µêµ¬
        const button = popup.querySelector('.popup-button');
        // closepopupìœ¼ë¡œ ë©”ì„œë“œ ë³€ê²½
        const closebutton = popup.querySelector('.btn-popup-close');
        if (closebutton) {
          closebutton.onclick = function() {
            closePopup('popup2'); // closePopupë¡œ í˜¸ì¶œ ë©”ì„œë“œ ë³€ê²½
          };
        }
        tinymce.get('ordtext').setContent("");
        if (button) {
          button.style.display = ''; // ê¸°ë³¸ ìŠ¤íƒ€ì¼ë¡œ ë³µêµ¬
        }
      }
    }

    function endtext(documentId) {
      // í•´ë‹¹ IDì˜ íŒì—… ìš”ì†Œë¥¼ ì°¾ìŒ
      const popup = document.getElementById(documentId);

      if (popup) {
        // íŒì—…ì„ í¬í•¨í•œ ëª¨ë‹¬ì„ ìˆ¨ê¹€
        const modal = popup.closest('.modal');
        if (modal) {
          modal.style.display = 'none';
          modal.classList.remove('show'); // ì• ë‹ˆë©”ì´ì…˜ ì œê±°
        }

        // íŒì—… ìì²´ ìˆ¨ê¹€
        popup.style.display = 'none';
        popup.classList.remove('show'); // ì• ë‹ˆë©”ì´ì…˜ ì œê±°

        // íŒì—… ë²„íŠ¼ ë³µêµ¬
        const button = popup.querySelector('.popup-button');
        if (button) {
          button.style.display = ''; // ê¸°ë³¸ ìŠ¤íƒ€ì¼ë¡œ ë³µêµ¬
          // ë˜ëŠ” button.classList.remove('hidden'); // í´ë˜ìŠ¤ ë°©ì‹ìœ¼ë¡œ ë³µêµ¬
        }
      }
      const isnewValue = Number(document.getElementById('isnew').value);
      const newRowData = {
        hgrb: getHgrb(document.getElementById("hgrb").value),
        qty: Number(document.getElementById("qty").value),
        panel_t: document.getElementById("panel_t").value,
        panel_w: document.getElementById("panel_w").value,
        panel_l: document.getElementById("panel_l").value,
        exfmtypedv: getListCgrb2(document.getElementById("exfmtypedv").value),
        infmtypedv: getListCgrb2(document.getElementById("infmtypedv").value),
        stframedv: getListCgrb2(document.getElementById("stframedv").value),
        stexplydv: getListCgrb2(document.getElementById("stexplydv").value),
        reqseq: document.getElementById("reqseq").value,
        ordtext: tinymce.get('ordtext').getContent(),
        originOrdtext: tinymce.get('ordtext').getContent(),
        isnew: isnewValue // isnewValueë¥¼ ì§ì ‘ ì‚¬ìš©
      };

      const sourceCollection = viewdata2.sourceCollection;
      let isUpdated = false;

      for (let i = 0; i < sourceCollection.length; i++) {
        if (newRowData.reqseq === sourceCollection[i].reqseq && newRowData.reqseq !== "") {
          sourceCollection[i] = newRowData;  // Update existing row
          isUpdated = true;
          break;
        } else if (Number(newRowData.isnew) === Number(sourceCollection[i].isnew) && newRowData.isnew !== "") {
          sourceCollection[i] = { ...sourceCollection[i], ...newRowData };  // Update existing row based on isnew
          isUpdated = true;  // ì—…ë°ì´íŠ¸ í”Œë˜ê·¸ ì„¤ì •
          break;  // ì—…ë°ì´íŠ¸ í›„ ë£¨í”„ ì¢…ë£Œ
        }
      }

      viewdata2.sourceCollection = [...sourceCollection]; // ì°¸ì¡° ê°±ì‹ 
      viewdata2.commitEdit(); // ë³€ê²½ ì‚¬í•­ ì»¤ë°‹
      viewdata2.refresh(); // ë°ì´í„° ì†ŒìŠ¤ ê°±ì‹ 
      theGrid2.itemsSource = [...viewdata2.sourceCollection]; // ê·¸ë¦¬ë“œ ë°ì´í„° ì¬ì„¤ì •
      theGrid2.refresh(); // UI ê°±ì‹ 
    }
    // ê°€ì´ë“œ web íŒì—…ì°½ ì—´ê¸°
    function openPopup(url) {
      // ìƒˆ ì°½ ì—´ê¸°
      window.open(url, '_blank',
              'width=1040,height=1000,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes');
    }
    // enterì…ë ¥ì‹œ ë‹¤ìŒ inputìœ¼ë¡œ cursorì´ë™
    function moveFocusOnEnter(currentId, nextId) {
      const currentElement = document.getElementById(currentId);
      currentElement.addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
          event.preventDefault(); // ê¸°ë³¸ Enter ë™ì‘ ë°©ì§€
          const nextElement = document.getElementById(nextId);
          if (nextElement) {
            nextElement.focus(); // í¬ì»¤ìŠ¤ ì´ë™
          }
        }
      });
    }
    moveFocusOnEnter("reqdate", "deldate");
    moveFocusOnEnter("deldate", "telno");
    moveFocusOnEnter("telno", "perid");
    moveFocusOnEnter("perid", "panel_ht");
    moveFocusOnEnter("panel_ht", "panel_hw");
    moveFocusOnEnter("panel_hw", "panel_hl");
    moveFocusOnEnter("panel_hl", "panel_hh");
    moveFocusOnEnter("panel_hh", "remark");
    moveFocusOnEnter("remark", "hgrb");
    moveFocusOnEnter("hgrb", "qty");
    moveFocusOnEnter("qty", "panel_t");
    moveFocusOnEnter("panel_t", "panel_w");
    moveFocusOnEnter("panel_w", "panel_l");
    moveFocusOnEnter("panel_l", "exfmtypedv");
    moveFocusOnEnter("exfmtypedv", "infmtypedv");
    moveFocusOnEnter("infmtypedv", "stframedv");
    moveFocusOnEnter("stframedv", "stexplydv");
  </script>

</th:block>
</html>

